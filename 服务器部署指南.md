# æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

çŸ¥è¯†åˆ†äº«æ’ç­è¡¨ç³»ç»Ÿ - ç”¨äºç®¡ç†å›¢é˜ŸçŸ¥è¯†åˆ†äº«æ´»åŠ¨çš„ Web åº”ç”¨ã€‚

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- ğŸ“… æ’ç­ç®¡ç†ï¼ˆäººå‘˜åˆ†é…ã€ä¸»é¢˜ã€å¤‡æ³¨ï¼‰
- ğŸ“ æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½ï¼ˆæŒ‰æ—¥æœŸåˆ†ç±»å­˜å‚¨ï¼‰
- âœ… ä»»åŠ¡å®ŒæˆçŠ¶æ€è·Ÿè¸ª
- ğŸ“ ç•™è¨€æ¿åŠŸèƒ½ï¼ˆå›¢é˜Ÿç•™è¨€ + é‡è¦å…¬å‘Šï¼‰
- ğŸ”— é“¾æ¥è‡ªåŠ¨è¯†åˆ«å’Œè·³è½¬
- ğŸ“Š ç»Ÿè®¡åˆ†æ
- ğŸ”„ è‡ªåŠ¨å¤‡ä»½
- ğŸ“ æ“ä½œæ—¥å¿—è®°å½•

## ğŸ”§ ç¯å¢ƒè¦æ±‚

### å¿…éœ€è½¯ä»¶
- **Node.js** >= 18.0.0
- **Python** 3.xï¼ˆç”¨äºå‰ç«¯é™æ€æ–‡ä»¶æœåŠ¡ï¼‰
- **npm** æˆ– yarn

### ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**ï¼šLinuxï¼ˆCentOS/Ubuntu/Debianï¼‰ã€macOS
- **ç£ç›˜ç©ºé—´**ï¼š>= 1GBï¼ˆç”¨äºæ–‡ä»¶ä¸Šä¼ å’Œå¤‡ä»½ï¼‰
- **å†…å­˜**ï¼š>= 512MB
- **ç½‘ç»œ**ï¼šå¼€æ”¾ç«¯å£ 3000ï¼ˆåç«¯ APIï¼‰å’Œ 8000ï¼ˆå‰ç«¯é¡µé¢ï¼‰

### å¯é€‰è½¯ä»¶ï¼ˆæ¨èï¼‰
- **PM2**ï¼šè¿›ç¨‹ç®¡ç†å™¨ï¼Œç”¨äºç”Ÿäº§ç¯å¢ƒ
- **Nginx**ï¼šåå‘ä»£ç†ï¼Œæä¾› HTTPS å’Œè´Ÿè½½å‡è¡¡
- **Screen/Tmux**ï¼šä¿æŒåå°è¿è¡Œ

---

## ğŸ“¦ éƒ¨ç½²æ–‡ä»¶æ¸…å•

### ä½¿ç”¨æ‰“åŒ…è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# åœ¨æœ¬åœ°é¡¹ç›®ç›®å½•æ‰§è¡Œ
./pack-for-deploy.sh
```

è¿™ä¼šè‡ªåŠ¨æ‰“åŒ…æ‰€æœ‰å¿…éœ€æ–‡ä»¶ä¸º `schedule-app-YYYYMMDD_HHMMSS.tar.gz`ã€‚

### æ‰‹åŠ¨æ‰“åŒ…

å¦‚æœéœ€è¦æ‰‹åŠ¨æ‰“åŒ…ï¼ŒåŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ schedule.html              # å‰ç«¯é¡µé¢
â”œâ”€â”€ start-backend.sh           # åç«¯å¯åŠ¨è„šæœ¬
â”œâ”€â”€ start-frontend.sh          # å‰ç«¯å¯åŠ¨è„šæœ¬
â”œâ”€â”€ backup.sh                  # å¤‡ä»½è„šæœ¬
â”œâ”€â”€ restore.sh                 # æ¢å¤è„šæœ¬
â”œâ”€â”€ BACKUP.md                  # å¤‡ä»½è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ LOGS.md                    # æ—¥å¿—è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ crontab.example            # å®šæ—¶ä»»åŠ¡é…ç½®ç¤ºä¾‹
â””â”€â”€ server/
    â”œâ”€â”€ package.json           # Node.js ä¾èµ–é…ç½®
    â”œâ”€â”€ package-lock.json      # ä¾èµ–ç‰ˆæœ¬é”å®š
    â”œâ”€â”€ server.js              # åç«¯æœåŠ¡å™¨ä»£ç 
    â”œâ”€â”€ db.json                # æ•°æ®åº“æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
    â””â”€â”€ uploads/               # æ–‡ä»¶ä¸Šä¼ ç›®å½•ï¼ˆè¿è¡Œæ—¶åˆ›å»ºï¼‰
```

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### æ­¥éª¤ 1ï¼šå‡†å¤‡æœåŠ¡å™¨ç¯å¢ƒ

#### æ£€æŸ¥ç¯å¢ƒ

```bash
# æ£€æŸ¥ Node.jsï¼ˆéœ€è¦ >= 18.0.0ï¼‰
node --version

# æ£€æŸ¥ Python3
python3 --version

# æ£€æŸ¥ npm
npm --version
```

#### å®‰è£…å¿…éœ€è½¯ä»¶

**CentOS/RHELï¼š**
```bash
# å®‰è£… Node.js 18
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo yum install -y nodejs

# Python3 é€šå¸¸å·²é¢„è£…
python3 --version
```

**Ubuntu/Debianï¼š**
```bash
# å®‰è£… Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs python3
```

**macOSï¼š**
```bash
# ä½¿ç”¨ Homebrew
brew install node python3
```

### æ­¥éª¤ 2ï¼šä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨

```bash
# æ–¹æ³• 1ï¼šä½¿ç”¨ scp
scp schedule-app-*.tar.gz ç”¨æˆ·å@æœåŠ¡å™¨åœ°å€:/éƒ¨ç½²è·¯å¾„/

# æ–¹æ³• 2ï¼šä½¿ç”¨ rsyncï¼ˆæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼‰
rsync -avz --progress schedule-app-*.tar.gz ç”¨æˆ·å@æœåŠ¡å™¨åœ°å€:/éƒ¨ç½²è·¯å¾„/
```

### æ­¥éª¤ 3ï¼šè§£å‹å¹¶å®‰è£…ä¾èµ–

```bash
# ç™»å½•åˆ°æœåŠ¡å™¨
ssh ç”¨æˆ·å@æœåŠ¡å™¨åœ°å€

# è§£å‹æ–‡ä»¶
tar -xzf schedule-app-*.tar.gz
cd schedule-app-deploy

# å®‰è£…åç«¯ä¾èµ–
cd server
npm install --production
cd ..

# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x *.sh
```

### æ­¥éª¤ 4ï¼šå¯åŠ¨æœåŠ¡

#### æ–¹å¼ä¸€ï¼šç›´æ¥è¿è¡Œï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰

**ç»ˆç«¯ 1 - å¯åŠ¨åç«¯ï¼š**
```bash
./start-backend.sh
```

**ç»ˆç«¯ 2 - å¯åŠ¨å‰ç«¯ï¼š**
```bash
./start-frontend.sh
```

#### æ–¹å¼äºŒï¼šåå°è¿è¡Œï¼ˆä½¿ç”¨ nohupï¼‰

```bash
# åå°è¿è¡Œåç«¯
nohup ./start-backend.sh > backend.log 2>&1 &

# åå°è¿è¡Œå‰ç«¯
nohup ./start-frontend.sh > frontend.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—
tail -f backend.log
tail -f frontend.log
```

#### æ–¹å¼ä¸‰ï¼šä½¿ç”¨ Screenï¼ˆæ¨èï¼‰

```bash
# å®‰è£… screen
sudo yum install screen    # CentOS/RHEL
sudo apt install screen    # Ubuntu/Debian

# åˆ›å»ºåç«¯ session
screen -S backend
./start-backend.sh
# æŒ‰ Ctrl+A ç„¶åæŒ‰ D ç¦»å¼€ï¼ˆæœåŠ¡ç»§ç»­è¿è¡Œï¼‰

# åˆ›å»ºå‰ç«¯ session
screen -S frontend
./start-frontend.sh
# æŒ‰ Ctrl+A ç„¶åæŒ‰ D ç¦»å¼€

# æŸ¥çœ‹æ‰€æœ‰ session
screen -ls

# é‡æ–°è¿æ¥åˆ° session
screen -r backend
screen -r frontend
```

#### æ–¹å¼å››ï¼šä½¿ç”¨ PM2ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

```bash
# å®‰è£… PM2
npm install -g pm2

# å¯åŠ¨åç«¯
pm2 start server/server.js --name schedule-backend

# å¯åŠ¨å‰ç«¯
pm2 start "python3 -m http.server 8000 --bind 0.0.0.0" --name schedule-frontend

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs

# ä¿å­˜é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
```

### æ­¥éª¤ 5ï¼šéªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://localhost:3000/schedule
curl http://localhost:8000/schedule.html

# æˆ–ä½¿ç”¨ PM2
pm2 status
```

æµè§ˆå™¨è®¿é—®ï¼š`http://æœåŠ¡å™¨åœ°å€:8000/schedule.html`

---

## ğŸŒ è®¿é—®åœ°å€

éƒ¨ç½²æˆåŠŸåï¼Œé€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **å‰ç«¯é¡µé¢**ï¼š`http://æœåŠ¡å™¨åœ°å€:8000/schedule.html`
- **åç«¯ API**ï¼š`http://æœåŠ¡å™¨åœ°å€:3000/schedule`

### API ç«¯ç‚¹

```
GET    /schedule              # è·å–æ’ç­æ•°æ®
PATCH  /schedule/:id          # æ›´æ–°æ’ç­æ•°æ®
GET    /statistics            # è·å–ç»Ÿè®¡æ•°æ®
GET    /messageBoard          # è·å–ç•™è¨€æ¿æ•°æ®
PUT    /messageBoard          # æ›´æ–°ç•™è¨€æ¿æ•°æ®
POST   /schedule/:id/files    # ä¸Šä¼ æ–‡ä»¶
GET    /schedule/:id/files/:index  # ä¸‹è½½æ–‡ä»¶
DELETE /schedule/:id/files/:index  # åˆ é™¤æ–‡ä»¶
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### ä¿®æ”¹åç«¯ç«¯å£

ç¼–è¾‘ `server/server.js` æˆ–è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
export PORT=3000
```

### ä¿®æ”¹å‰ç«¯ç«¯å£

ç¼–è¾‘ `start-frontend.sh`ï¼Œä¿®æ”¹ç«¯å£å·ï¼š

```bash
python3 -m http.server 8001 --bind 0.0.0.0
```

### å‰ç«¯ API åœ°å€é…ç½®

å‰ç«¯å·²é…ç½®ä¸º**è‡ªåŠ¨æ£€æµ‹**è®¿é—®åœ°å€ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹ï¼š

```javascript
// schedule.html ä¸­çš„ API é…ç½®ï¼ˆå·²è‡ªåŠ¨é€‚é…ï¼‰
const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
    ? 'http://localhost:3000'
    : `http://${window.location.hostname}:3000`;
```

è¿™æ„å‘³ç€ï¼š
- æœ¬åœ°è®¿é—® `localhost:8000` â†’ API ä½¿ç”¨ `localhost:3000`
- æœåŠ¡å™¨è®¿é—® `10.2.122.210:8000` â†’ API ä½¿ç”¨ `10.2.122.210:3000`
- è‡ªåŠ¨é€‚é…ä»»ä½• IP åœ°å€ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®

### é…ç½® Nginx åå‘ä»£ç†ï¼ˆå¯é€‰ï¼Œæ¨èï¼‰

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # å‰ç«¯
    location / {
        proxy_pass http://localhost:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # åç«¯ API
    location /api/ {
        proxy_pass http://localhost:3000/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;

        # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶
        client_max_body_size 50M;
    }
}
```

é…ç½® HTTPSï¼ˆä½¿ç”¨ Let's Encryptï¼‰ï¼š

```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx

# è·å– SSL è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

---

## ğŸ”¥ é˜²ç«å¢™é…ç½®

å¦‚æœæ— æ³•è®¿é—®ï¼Œéœ€è¦å¼€æ”¾ç«¯å£ã€‚

**CentOS/RHEL (firewalld)ï¼š**
```bash
sudo firewall-cmd --permanent --add-port=3000/tcp
sudo firewall-cmd --permanent --add-port=8000/tcp
sudo firewall-cmd --reload

# æŸ¥çœ‹å·²å¼€æ”¾ç«¯å£
sudo firewall-cmd --list-ports
```

**Ubuntu/Debian (ufw)ï¼š**
```bash
sudo ufw allow 3000/tcp
sudo ufw allow 8000/tcp
sudo ufw reload

# æŸ¥çœ‹çŠ¶æ€
sudo ufw status
```

**iptablesï¼š**
```bash
sudo iptables -I INPUT -p tcp --dport 3000 -j ACCEPT
sudo iptables -I INPUT -p tcp --dport 8000 -j ACCEPT
sudo service iptables save
```

---

## ğŸ’¾ æ•°æ®å¤‡ä»½ï¼ˆé‡è¦ï¼ï¼‰

ç³»ç»ŸåŒ…å«è‡ªåŠ¨å¤‡ä»½åŠŸèƒ½ï¼Œå»ºè®®é…ç½®å®šæœŸå¤‡ä»½ã€‚

### æ‰‹åŠ¨å¤‡ä»½

```bash
./backup.sh
```

å¤‡ä»½æ–‡ä»¶ä¿å­˜åœ¨ `backups/` ç›®å½•ï¼ŒåŒ…å«ï¼š
- `db.json`ï¼ˆæ•°æ®åº“æ–‡ä»¶ï¼‰
- `uploads/`ï¼ˆä¸Šä¼ çš„æ–‡ä»¶ï¼‰

### è‡ªåŠ¨å®šæ—¶å¤‡ä»½

```bash
# ç¼–è¾‘ crontab
crontab -e

# æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨ 2 ç‚¹å¤‡ä»½ï¼‰
0 2 * * * cd /éƒ¨ç½²è·¯å¾„/schedule-app-deploy && ./backup.sh >> backups/backup.log 2>&1
```

æ›´å¤šå®šæ—¶ä»»åŠ¡é…ç½®ï¼Œè¯·å‚è€ƒé¡¹ç›®ä¸­çš„ `crontab.example` æ–‡ä»¶ã€‚

### æ¢å¤å¤‡ä»½

```bash
./restore.sh
```

è¯¦ç»†è¯´æ˜è¯·å‚é˜… `BACKUP.md`ã€‚

---

## ğŸ“ æ“ä½œæ—¥å¿—

ç³»ç»Ÿä¼šè‡ªåŠ¨è®°å½•ä»¥ä¸‹æ“ä½œåˆ° `server/operation.log`ï¼š

- ä¿®æ”¹ä¸»é¢˜
- ä¿®æ”¹å¤‡æ³¨
- ä¸Šä¼ æ–‡ä»¶
- åˆ é™¤æ–‡ä»¶
- æ›´æ–°ç•™è¨€æ¿

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶ç›‘æ§
tail -f server/operation.log

# æŸ¥çœ‹ä»Šå¤©çš„æ“ä½œ
grep "$(date +%Y-%m-%d)" server/operation.log

# æŸ¥çœ‹æ–‡ä»¶æ“ä½œ
grep "ä¸Šä¼ æ–‡ä»¶\|åˆ é™¤æ–‡ä»¶" server/operation.log

# ç»Ÿè®¡æ“ä½œæ¬¡æ•°
grep "ä¿®æ”¹ä¸»é¢˜" server/operation.log | wc -l
```

è¯¦ç»†è¯´æ˜è¯·å‚é˜… `LOGS.md`ã€‚

---

## ğŸ“‚ ç›®å½•ç»“æ„

```
schedule-app-deploy/
â”œâ”€â”€ schedule.html              # å‰ç«¯é¡µé¢
â”œâ”€â”€ start-backend.sh           # åç«¯å¯åŠ¨è„šæœ¬
â”œâ”€â”€ start-frontend.sh          # å‰ç«¯å¯åŠ¨è„šæœ¬
â”œâ”€â”€ backup.sh                  # å¤‡ä»½è„šæœ¬
â”œâ”€â”€ restore.sh                 # æ¢å¤è„šæœ¬
â”œâ”€â”€ DEPLOY.md                  # éƒ¨ç½²æŒ‡å—ï¼ˆè‹±æ–‡ç‰ˆï¼‰
â”œâ”€â”€ æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—.md          # éƒ¨ç½²æŒ‡å—ï¼ˆä¸­æ–‡ç‰ˆï¼Œæœ¬æ–‡æ¡£ï¼‰
â”œâ”€â”€ BACKUP.md                  # å¤‡ä»½è¯´æ˜
â”œâ”€â”€ LOGS.md                    # æ—¥å¿—è¯´æ˜
â”œâ”€â”€ crontab.example            # å®šæ—¶ä»»åŠ¡ç¤ºä¾‹
â”œâ”€â”€ backups/                   # å¤‡ä»½ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚   â””â”€â”€ backup_*.tar.gz
â””â”€â”€ server/
    â”œâ”€â”€ server.js              # åç«¯æœåŠ¡
    â”œâ”€â”€ db.json                # æ•°æ®åº“æ–‡ä»¶
    â”œâ”€â”€ package.json           # ä¾èµ–é…ç½®
    â”œâ”€â”€ operation.log          # æ“ä½œæ—¥å¿—
    â””â”€â”€ uploads/               # æ–‡ä»¶ä¸Šä¼ ç›®å½•ï¼ˆæŒ‰æ—¥æœŸåˆ†ç±»ï¼‰
        â”œâ”€â”€ schedule_1/
        â”œâ”€â”€ schedule_2/
        â””â”€â”€ ...
```

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### 1. æ–‡ä»¶ç®¡ç†
- **æŒ‰æ’ç­åˆ†ç±»å­˜å‚¨**ï¼šä¸Šä¼ çš„æ–‡ä»¶æŒ‰æ’ç­ ID åˆ†ç±»ä¿å­˜
- **ä¸Šä¼ è¿›åº¦æ˜¾ç¤º**ï¼šå®æ—¶æ˜¾ç¤ºä¸Šä¼ è¿›åº¦æ¡
- **æ–‡ä»¶å¤§å°é™åˆ¶**ï¼šå•ä¸ªæ–‡ä»¶æœ€å¤§ 50MB
- **å¤šæ–‡ä»¶ä¸Šä¼ **ï¼šæ”¯æŒåŒæ—¶ä¸Šä¼ å¤šä¸ªæ–‡ä»¶

### 2. ç•™è¨€æ¿åŠŸèƒ½
- **å›¢é˜Ÿç•™è¨€**ï¼šæ”¯æŒå¤šè¡Œç•™è¨€ï¼Œæ ¼å¼åŒ–å»ºè®®
- **é‡è¦å…¬å‘Š**ï¼šå‘å¸ƒå›¢é˜Ÿå…¬å‘Š
- **æ•°æ®æŒä¹…åŒ–**ï¼šè‡ªåŠ¨ä¿å­˜åˆ°æœåŠ¡å™¨
- **å®æ—¶æ›´æ–°**ï¼šæ”¯æŒå¤šç”¨æˆ·åä½œ

### 3. é“¾æ¥è‡ªåŠ¨è¯†åˆ«
- **è‡ªåŠ¨è¯†åˆ«**ï¼šè‡ªåŠ¨è¯†åˆ« `http://` å’Œ `https://` é“¾æ¥
- **æ™ºèƒ½å¤„ç†**ï¼šå»é™¤æœ«å°¾æ ‡ç‚¹ç¬¦å·
- **æ–°çª—å£æ‰“å¼€**ï¼šç‚¹å‡»é“¾æ¥åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€
- **è§†è§‰åé¦ˆ**ï¼šæ©™è‰²é«˜äº®ï¼Œæ‚¬åœåŠ¨ç”»æ•ˆæœ

### 4. è‡ªåŠ¨åŒ–åŠŸèƒ½
- **è‡ªåŠ¨è¿‡æœŸå‹¾é€‰**ï¼šæ—¥æœŸè¿‡æœŸçš„ä»»åŠ¡è‡ªåŠ¨æ ‡è®°ä¸ºå®Œæˆ
- **è‡ªåŠ¨å¤‡ä»½**ï¼šå¯é…ç½®å®šæœŸè‡ªåŠ¨å¤‡ä»½æ•°æ®å’Œæ–‡ä»¶
- **è‡ªåŠ¨åˆ·æ–°**ï¼šæ•°æ®æ¯ 10 ç§’è‡ªåŠ¨åˆ·æ–°ï¼ˆä¸é—ªçƒï¼‰
- **æ™ºèƒ½æ›´æ–°**ï¼šåªæ›´æ–°å˜åŒ–çš„æ•°æ®ï¼Œå‡å°‘é¡µé¢é—ªçƒ

### 5. æ“ä½œè®°å½•
- **è¯¦ç»†æ—¥å¿—**ï¼šè®°å½•æ‰€æœ‰ç¼–è¾‘æ“ä½œã€æ–‡ä»¶æ“ä½œ
- **IP è¿½è¸ª**ï¼šè®°å½•æ“ä½œæ¥æº IP åœ°å€
- **æ—¶é—´æˆ³**ï¼šç²¾ç¡®åˆ°æ¯«ç§’çš„æ“ä½œæ—¶é—´
- **æ—¥å¿—åˆ†æ**ï¼šæ”¯æŒæŒ‰æ—¶é—´ã€ç±»å‹ã€IP ç­›é€‰

---

## ğŸ” å¸¸ç”¨å‘½ä»¤

### æœåŠ¡ç®¡ç†

```bash
# ä½¿ç”¨ nohup æ–¹å¼
# å¯åŠ¨
nohup ./start-backend.sh > backend.log 2>&1 &
nohup ./start-frontend.sh > frontend.log 2>&1 &

# åœæ­¢
pkill -f "node server.js"
pkill -f "python3 -m http.server"

# ä½¿ç”¨ PM2 æ–¹å¼
# å¯åŠ¨
pm2 start server/server.js --name schedule-backend
pm2 start "python3 -m http.server 8000 --bind 0.0.0.0" --name schedule-frontend

# åœæ­¢
pm2 stop schedule-backend schedule-frontend

# é‡å¯
pm2 restart all

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs

# åˆ é™¤è¿›ç¨‹
pm2 delete schedule-backend schedule-frontend
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f backend.log              # nohup æ–¹å¼
pm2 logs schedule-backend        # PM2 æ–¹å¼

# æŸ¥çœ‹å‰ç«¯æ—¥å¿—
tail -f frontend.log
pm2 logs schedule-frontend

# æŸ¥çœ‹æ“ä½œæ—¥å¿—
tail -f server/operation.log
```

### å¤‡ä»½ä¸æ¢å¤

```bash
# æ‰‹åŠ¨å¤‡ä»½
./backup.sh

# æŸ¥çœ‹å¤‡ä»½åˆ—è¡¨
ls -lh backups/

# æ¢å¤å¤‡ä»½
./restore.sh
```

### è¿›ç¨‹æ£€æŸ¥

```bash
# æŸ¥çœ‹è¿è¡Œçš„è¿›ç¨‹
ps aux | grep node
ps aux | grep python

# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :3000
lsof -i :8000

# æˆ–ä½¿ç”¨ ss
ss -tlnp | grep 3000
ss -tlnp | grep 8000
```

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :3000
lsof -i :8000

# æ€æ­»å ç”¨è¿›ç¨‹
kill -9 <PID>
```

### é—®é¢˜ 2ï¼šæƒé™é—®é¢˜

```bash
# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x *.sh

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la server/db.json
ls -la server/uploads

# ä¿®å¤æƒé™
chmod 644 server/db.json
chmod 755 server/uploads
chmod 755 server/uploads/*
```

### é—®é¢˜ 3ï¼šæ— æ³•è®¿é—®

1. **æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ç«¯å£**
   ```bash
   sudo ufw allow 3000
   sudo ufw allow 8000
   ```

2. **æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ**
   ```bash
   ps aux | grep node
   ps aux | grep python
   ```

3. **æ£€æŸ¥ç½‘ç»œè¿æ¥**
   ```bash
   curl http://localhost:3000/schedule
   curl http://localhost:8000/schedule.html
   ```

### é—®é¢˜ 4ï¼šNode.js ç‰ˆæœ¬è¿‡ä½

```bash
# æ£€æŸ¥ç‰ˆæœ¬
node --version

# ä½¿ç”¨ nvm å‡çº§ï¼ˆå¦‚æœå·²å®‰è£…ï¼‰
nvm install 18
nvm use 18

# æˆ–é‡æ–°å®‰è£… Node.js
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo yum install -y nodejs
```

### é—®é¢˜ 5ï¼šnpm install å¤±è´¥

```bash
# æ¸…ç† npm ç¼“å­˜
npm cache clean --force

# åˆ é™¤ node_modules é‡æ–°å®‰è£…
rm -rf node_modules package-lock.json
npm install

# ä½¿ç”¨å›½å†…é•œåƒï¼ˆä¸­å›½ç”¨æˆ·ï¼‰
npm install --registry=https://registry.npmmirror.com
```

### é—®é¢˜ 6ï¼šæ–‡ä»¶ä¸Šä¼ å¤±è´¥

```bash
# æ£€æŸ¥ uploads ç›®å½•
ls -ld server/uploads

# åˆ›å»ºç›®å½•å¹¶è®¾ç½®æƒé™
mkdir -p server/uploads
chmod 755 server/uploads

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h
```

### é—®é¢˜ 7ï¼šæ•°æ®æ— æ³•ä¿å­˜

```bash
# æ£€æŸ¥ db.json æƒé™
ls -l server/db.json
chmod 644 server/db.json

# æ£€æŸ¥ db.json æ ¼å¼
cat server/db.json | python3 -m json.tool

# æŸ¥çœ‹åç«¯é”™è¯¯æ—¥å¿—
tail -f backend.log
```

### é—®é¢˜ 8ï¼šPM2 æ— æ³•å¯åŠ¨

```bash
# æ£€æŸ¥ PM2 çŠ¶æ€
pm2 status

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs --err

# é‡ç½® PM2
pm2 kill
pm2 start server/server.js --name schedule-backend
```

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

å½“æœ‰æ–°ç‰ˆæœ¬æ—¶ï¼š

```bash
# 1. å¤‡ä»½å½“å‰æ•°æ®
./backup.sh

# 2. åœæ­¢æœåŠ¡
pm2 stop all
# æˆ–
pkill -f "node server.js"
pkill -f "python3 -m http.server"

# 3. ä¸Šä¼ å¹¶è§£å‹æ–°ç‰ˆæœ¬
scp schedule-app-new-version.tar.gz ç”¨æˆ·å@æœåŠ¡å™¨:/éƒ¨ç½²è·¯å¾„/
tar -xzf schedule-app-new-version.tar.gz

# 4. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœ‰å˜åŒ–ï¼‰
cd server
npm install --production
cd ..

# 5. æ¢å¤æ•°æ®ï¼ˆå¦‚éœ€è¦ï¼‰
./restore.sh

# 6. é‡å¯æœåŠ¡
pm2 restart all
# æˆ–
nohup ./start-backend.sh > backend.log 2>&1 &
nohup ./start-frontend.sh > frontend.log 2>&1 &
```

---

## ğŸŒ æœåŠ¡å™¨è¿ç§»

### è‡ªåŠ¨é€‚é… IP åœ°å€

å¯åŠ¨è„šæœ¬å’Œå‰ç«¯å·²é…ç½®ä¸º**è‡ªåŠ¨æ£€æµ‹** IP åœ°å€ï¼Œè¿ç§»åˆ°æ–°æœåŠ¡å™¨æ— éœ€ä¿®æ”¹ä»»ä½•é…ç½®æ–‡ä»¶ã€‚

### è¿ç§»æ­¥éª¤

å‡è®¾ä» `10.2.122.210` è¿ç§»åˆ° `10.3.100.50`ï¼š

```bash
# 1. åœ¨æ—§æœåŠ¡å™¨ä¸Šå¤‡ä»½
./backup.sh
tar -czf schedule-migrate.tar.gz \
  schedule.html start-*.sh backup.sh restore.sh \
  server/ backups/

# 2. ä¸Šä¼ åˆ°æ–°æœåŠ¡å™¨
scp schedule-migrate.tar.gz ç”¨æˆ·å@10.3.100.50:~/

# 3. åœ¨æ–°æœåŠ¡å™¨ä¸Šéƒ¨ç½²
ssh ç”¨æˆ·å@10.3.100.50
tar -xzf schedule-migrate.tar.gz
cd server && npm install --production && cd ..
chmod +x *.sh

# 4. å¯åŠ¨æœåŠ¡
./start-backend.sh    # ç»ˆç«¯ 1
./start-frontend.sh   # ç»ˆç«¯ 2

# 5. è®¿é—®æ–°åœ°å€ï¼ˆè‡ªåŠ¨é€‚é…ï¼‰
# http://10.3.100.50:8000/schedule.html
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. ä½¿ç”¨ PM2 é›†ç¾¤æ¨¡å¼

```bash
# ä½¿ç”¨å¤šæ ¸ CPU
pm2 start server/server.js -i max --name schedule-backend
```

### 2. é…ç½® Nginx ç¼“å­˜

```nginx
# é™æ€èµ„æºç¼“å­˜
location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

### 3. å¯ç”¨ Gzip å‹ç¼©

åœ¨ Nginx é…ç½®ä¸­ï¼š

```nginx
gzip on;
gzip_types text/plain text/css application/json application/javascript text/xml application/xml;
gzip_min_length 1000;
```

### 4. æ•°æ®åº“ä¼˜åŒ–

å®šæœŸæ¸…ç†æ—§æ—¥å¿—ï¼š

```bash
# åªä¿ç•™æœ€è¿‘ 30 å¤©çš„æ—¥å¿—
find server/ -name "*.log" -mtime +30 -delete
```

---

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. é™åˆ¶è®¿é—®

ä½¿ç”¨ Nginx æ·»åŠ  IP ç™½åå•ï¼š

```nginx
location / {
    allow 192.168.1.0/24;
    deny all;
    proxy_pass http://localhost:8000;
}
```

### 2. æ·»åŠ è®¤è¯

ä½¿ç”¨ Nginx Basic Authï¼š

```bash
# å®‰è£…å·¥å…·
sudo apt install apache2-utils

# åˆ›å»ºå¯†ç æ–‡ä»¶
sudo htpasswd -c /etc/nginx/.htpasswd username

# åœ¨ Nginx é…ç½®ä¸­æ·»åŠ 
auth_basic "Restricted Access";
auth_basic_user_file /etc/nginx/.htpasswd;
```

### 3. æ–‡ä»¶ä¸Šä¼ å®‰å…¨

- é™åˆ¶æ–‡ä»¶ç±»å‹
- é™åˆ¶æ–‡ä»¶å¤§å°ï¼ˆå·²è®¾ç½®ä¸º 50MBï¼‰
- å®šæœŸæ‰«æä¸Šä¼ æ–‡ä»¶

### 4. æ—¥å¿—ä¿æŠ¤

```bash
# é™åˆ¶æ—¥å¿—è®¿é—®æƒé™
chmod 600 server/operation.log
chown youruser:yourgroup server/operation.log
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜æ—¶ï¼š

1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š`backend.log` å’Œ `server/operation.log`
2. æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š`pm2 status` æˆ– `ps aux | grep node`
3. æŸ¥çœ‹æ–‡æ¡£ï¼š`BACKUP.md`ã€`LOGS.md`
4. æ£€æŸ¥é˜²ç«å¢™å’Œç«¯å£

### ç³»ç»Ÿè¦æ±‚æ£€æŸ¥æ¸…å•

- âœ… Node.js >= 18.0.0
- âœ… Python3 å·²å®‰è£…
- âœ… ç«¯å£ 3000 å’Œ 8000 å·²å¼€æ”¾
- âœ… ç£ç›˜ç©ºé—´å……è¶³
- âœ… æ–‡ä»¶æƒé™æ­£ç¡®
- âœ… ç½‘ç»œè¿æ¥æ­£å¸¸

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **éƒ¨ç½²æŒ‡å—ï¼ˆè‹±æ–‡ç‰ˆï¼‰**ï¼š`DEPLOY.md`
- **å¤‡ä»½æŒ‡å—**ï¼š`BACKUP.md`
- **æ—¥å¿—è¯´æ˜**ï¼š`LOGS.md`
- **å®šæ—¶ä»»åŠ¡ç¤ºä¾‹**ï¼š`crontab.example`

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v2.0 (2025-12-22)
- âœ¨ é‡æ–°æ•´ç†éƒ¨ç½²æŒ‡å—ï¼Œå†…å®¹æ›´å…¨é¢
- âœ¨ æ·»åŠ æ›´å¤šæ•…éšœæ’æŸ¥æ–¹æ¡ˆï¼ˆ8 ä¸ªå¸¸è§é—®é¢˜ï¼‰
- âœ¨ å¢åŠ æ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼ˆPM2 é›†ç¾¤ã€Nginx ç¼“å­˜ç­‰ï¼‰
- âœ¨ å®Œå–„å®‰å…¨é…ç½®è¯´æ˜ï¼ˆIP ç™½åå•ã€Basic Authï¼‰
- âœ¨ æ–°å¢æœåŠ¡å™¨è¿ç§»æŒ‡å—
- âœ¨ æä¾› 4 ç§éƒ¨ç½²æ–¹å¼ï¼ˆç›´æ¥è¿è¡Œã€nohupã€Screenã€PM2ï¼‰

### v1.0 (2025-12-20)
- âœ¨ æ–°å¢ç•™è¨€æ¿åŠŸèƒ½
- âœ¨ é“¾æ¥è‡ªåŠ¨è¯†åˆ«
- âœ¨ æ–‡ä»¶ä¸Šä¼ ä¸‹è½½
- âœ¨ æ€§èƒ½ä¼˜åŒ–

---

## ğŸ¯ å¿«é€Ÿå‚è€ƒ

### ä¸€é”®å¯åŠ¨ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

```bash
# å®‰è£… PM2
npm install -g pm2

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
pm2 start server/server.js --name schedule-backend
pm2 start "python3 -m http.server 8000 --bind 0.0.0.0" --name schedule-frontend

# ä¿å­˜é…ç½®å¹¶è®¾ç½®å¼€æœºè‡ªå¯
pm2 save
pm2 startup
```

### ä¸€é”®å¤‡ä»½

```bash
# é…ç½®æ¯å¤©å‡Œæ™¨ 2 ç‚¹è‡ªåŠ¨å¤‡ä»½
crontab -e
# æ·»åŠ : 0 2 * * * cd /éƒ¨ç½²è·¯å¾„ && ./backup.sh >> backups/backup.log 2>&1
```

### å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
pm2 status          # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 logs            # æŸ¥çœ‹æ—¥å¿—
pm2 restart all     # é‡å¯æ‰€æœ‰æœåŠ¡
./backup.sh         # æ‰‹åŠ¨å¤‡ä»½
./restore.sh        # æ¢å¤å¤‡ä»½
tail -f server/operation.log  # æŸ¥çœ‹æ“ä½œæ—¥å¿—
```

---

**éƒ¨ç½²å®Œæˆåè®°å¾—ï¼š**
- âœ… é…ç½®è‡ªåŠ¨å¤‡ä»½ï¼ˆcrontabï¼‰
- âœ… è®¾ç½®é˜²ç«å¢™è§„åˆ™
- âœ… é…ç½®å¼€æœºè‡ªå¯ï¼ˆPM2ï¼‰
- âœ… å®šæœŸæŸ¥çœ‹æ—¥å¿—
- âœ… æµ‹è¯•æ•°æ®æ¢å¤æµç¨‹
- âœ… é…ç½® Nginx åå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰
- âœ… è®¾ç½® HTTPS è¯ä¹¦ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

**æœ€åæ›´æ–°ï¼š** 2025-12-22
**ç‰ˆæœ¬ï¼š** v2.0
