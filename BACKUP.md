# æ•°æ®å¤‡ä»½ä¸æ¢å¤æŒ‡å—

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•å¤‡ä»½å’Œæ¢å¤çŸ¥è¯†åˆ†äº«æ’ç­è¡¨çš„æ•°æ®ï¼ˆdb.json å’Œ uploads æ–‡ä»¶å¤¹ï¼‰ã€‚

## ğŸ“¦ å¤‡ä»½å†…å®¹

è‡ªåŠ¨å¤‡ä»½åŒ…æ‹¬ï¼š
- `server/db.json` - æ‰€æœ‰æ’ç­æ•°æ®
- `server/uploads/` - æ‰€æœ‰ä¸Šä¼ çš„æ–‡ä»¶

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ‰‹åŠ¨å¤‡ä»½

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š
```bash
./backup.sh
```

å¤‡ä»½æ–‡ä»¶å°†ä¿å­˜åˆ° `backups/` ç›®å½•ï¼Œæ ¼å¼ä¸ºï¼š`backup_YYYYMMDD_HHMMSS.tar.gz`

### 2. æ‰‹åŠ¨æ¢å¤

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š
```bash
./restore.sh
```

æŒ‰ç…§äº¤äº’å¼æç¤ºé€‰æ‹©è¦æ¢å¤çš„å¤‡ä»½ã€‚

## â° è‡ªåŠ¨å®šæ—¶å¤‡ä»½

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Cronï¼ˆæ¨èï¼‰

1. **ç¼–è¾‘ crontab**
   ```bash
   crontab -e
   ```

2. **æ·»åŠ å®šæ—¶ä»»åŠ¡**
   ```bash
   # æ¯å¤©å‡Œæ™¨ 2 ç‚¹è‡ªåŠ¨å¤‡ä»½
   0 2 * * * cd /path/to/schedule-app && ./backup.sh >> backups/backup.log 2>&1
   ```

3. **æ›¿æ¢è·¯å¾„**
   å°† `/path/to/schedule-app` æ›¿æ¢ä¸ºå®é™…é¡¹ç›®è·¯å¾„ï¼Œä¾‹å¦‚ï¼š
   ```bash
   0 2 * * * cd /home/user/schedule-app && ./backup.sh >> backups/backup.log 2>&1
   ```

4. **ä¿å­˜å¹¶é€€å‡º**
   - Vim: æŒ‰ `ESC`ï¼Œè¾“å…¥ `:wq`ï¼Œå›è½¦
   - Nano: æŒ‰ `Ctrl+X`ï¼Œè¾“å…¥ `Y`ï¼Œå›è½¦

5. **éªŒè¯å®šæ—¶ä»»åŠ¡**
   ```bash
   crontab -l
   ```

### æ–¹æ³•äºŒï¼šä½¿ç”¨ PM2ï¼ˆå¦‚æœä½¿ç”¨ PM2 ç®¡ç†æœåŠ¡ï¼‰

åˆ›å»ºä¸€ä¸ªå¤‡ä»½è„šæœ¬å¹¶ä½¿ç”¨ PM2 çš„ cron åŠŸèƒ½ï¼š

```bash
pm2 start backup.sh --cron "0 2 * * *" --no-autorestart
```

## ğŸ“… å¤‡ä»½é¢‘ç‡å»ºè®®

æ ¹æ®æ•°æ®é‡è¦æ€§é€‰æ‹©åˆé€‚çš„å¤‡ä»½é¢‘ç‡ï¼š

| åœºæ™¯ | å»ºè®®é¢‘ç‡ | Cron è¡¨è¾¾å¼ |
|------|---------|------------|
| é‡è¦æ•°æ® | æ¯ 6 å°æ—¶ | `0 */6 * * *` |
| æ­£å¸¸ä½¿ç”¨ | æ¯å¤©ä¸€æ¬¡ | `0 2 * * *` |
| ä½é¢‘ä½¿ç”¨ | æ¯å‘¨ä¸€æ¬¡ | `0 2 * * 1` |
| å­˜æ¡£å¤‡ä»½ | æ¯æœˆä¸€æ¬¡ | `0 2 1 * *` |

## ğŸ“‚ å¤‡ä»½ç®¡ç†

### æŸ¥çœ‹å¤‡ä»½åˆ—è¡¨

```bash
ls -lh backups/
```

### æŸ¥çœ‹å¤‡ä»½æ—¥å¿—

```bash
tail -f backups/backup.log
```

### è‡ªåŠ¨æ¸…ç†æ—§å¤‡ä»½

è„šæœ¬ä¼šè‡ªåŠ¨ä¿ç•™æœ€è¿‘ 30 ä¸ªå¤‡ä»½ï¼Œæ—§å¤‡ä»½ä¼šè‡ªåŠ¨åˆ é™¤ã€‚

å¦‚éœ€ä¿®æ”¹ä¿ç•™æ•°é‡ï¼Œç¼–è¾‘ `backup.sh`ï¼š
```bash
KEEP_BACKUPS=30  # ä¿®æ”¹ä¸ºéœ€è¦ä¿ç•™çš„æ•°é‡
```

### æ‰‹åŠ¨ä¸‹è½½å¤‡ä»½åˆ°æœ¬åœ°

```bash
# ä»æœåŠ¡å™¨ä¸‹è½½å¤‡ä»½
scp user@server:/path/to/schedule-app/backups/backup_20251220_*.tar.gz ./local-backups/
```

## ğŸ”§ æ¢å¤æ•°æ®

### äº¤äº’å¼æ¢å¤

```bash
./restore.sh
```

æ¢å¤è„šæœ¬ä¼šï¼š
1. æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å¤‡ä»½
2. è®©ä½ é€‰æ‹©è¦æ¢å¤çš„å¤‡ä»½
3. é¢„è§ˆå¤‡ä»½å†…å®¹
4. è‡ªåŠ¨åˆ›å»ºå½“å‰æ•°æ®çš„å®‰å…¨å¤‡ä»½
5. ç¡®è®¤åæ‰§è¡Œæ¢å¤

### æŸ¥çœ‹å¤‡ä»½å†…å®¹ï¼ˆä¸æ¢å¤ï¼‰

```bash
# è§£å‹æŸ¥çœ‹å¤‡ä»½å†…å®¹
tar -tzf backups/backup_20251220_120000.tar.gz

# è§£å‹åˆ°ä¸´æ—¶ç›®å½•æŸ¥çœ‹
mkdir temp && tar -xzf backups/backup_20251220_120000.tar.gz -C temp/
cat temp/backup_info.txt
rm -rf temp
```

## âš ï¸ é‡è¦æç¤º

### æ¢å¤å‰çš„æ³¨æ„äº‹é¡¹

1. **åœæ­¢æœåŠ¡å™¨**
   ```bash
   # å¦‚æœä½¿ç”¨ PM2
   pm2 stop schedule-backend schedule-frontend

   # å¦‚æœä½¿ç”¨ nohup
   pkill -f "node server.js"
   pkill -f "python3 -m http.server"
   ```

2. **è‡ªåŠ¨å®‰å…¨å¤‡ä»½**
   æ¢å¤è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºå½“å‰æ•°æ®çš„å®‰å…¨å¤‡ä»½

3. **éªŒè¯æ¢å¤ç»“æœ**
   æ¢å¤åå¯åŠ¨æœåŠ¡å™¨ï¼Œæ£€æŸ¥æ•°æ®æ˜¯å¦æ­£ç¡®

### ç¾éš¾æ¢å¤

å¦‚æœæœåŠ¡å™¨å®Œå…¨æŸåï¼Œéœ€è¦åœ¨æ–°æœåŠ¡å™¨ä¸Šæ¢å¤ï¼š

1. **éƒ¨ç½²æ–°æœåŠ¡å™¨**
   ```bash
   # ä¸Šä¼ é¡¹ç›®æ–‡ä»¶
   scp schedule-app-*.tar.gz user@new-server:/path/

   # è§£å‹å¹¶å®‰è£…ä¾èµ–
   tar -xzf schedule-app-*.tar.gz
   cd schedule-app-deploy
   cd server && npm install --production && cd ..
   ```

2. **ä¸Šä¼ å¤‡ä»½æ–‡ä»¶**
   ```bash
   scp backups/backup_*.tar.gz user@new-server:/path/to/schedule-app/backups/
   ```

3. **æ¢å¤æ•°æ®**
   ```bash
   ./restore.sh
   ```

4. **å¯åŠ¨æœåŠ¡**
   ```bash
   ./start-backend.sh &
   ./start-frontend.sh &
   ```

## ğŸ“Š å¤‡ä»½æ–‡ä»¶ç»“æ„

å¤‡ä»½æ–‡ä»¶ï¼ˆ.tar.gzï¼‰åŒ…å«ï¼š
```
backup_20251220_120000.tar.gz
â”œâ”€â”€ db.json                  # æ•°æ®åº“æ–‡ä»¶
â”œâ”€â”€ uploads/                 # ä¸Šä¼ æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ 2025-11-28/
â”‚   â”œâ”€â”€ 2025-12-05/
â”‚   â””â”€â”€ ...
â””â”€â”€ backup_info.txt          # å¤‡ä»½ä¿¡æ¯
```

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šCron æ²¡æœ‰æ‰§è¡Œå¤‡ä»½

**æ£€æŸ¥ cron æœåŠ¡**
```bash
# Debian/Ubuntu
sudo service cron status

# CentOS/RHEL
sudo systemctl status crond
```

**æ£€æŸ¥æ—¥å¿—**
```bash
tail -f /var/log/syslog | grep CRON
tail -f backups/backup.log
```

### é—®é¢˜ï¼šæƒé™ä¸è¶³

```bash
# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x backup.sh restore.sh

# æ£€æŸ¥ç›®å½•æƒé™
ls -ld backups server/uploads
```

### é—®é¢˜ï¼šç£ç›˜ç©ºé—´ä¸è¶³

```bash
# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# æ¸…ç†æ—§å¤‡ä»½
cd backups && ls -lt | tail -n +31 | awk '{print $9}' | xargs rm -f
```

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å¼‚åœ°å¤‡ä»½**
   - å®šæœŸå°†å¤‡ä»½æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°
   - æˆ–ä½¿ç”¨äº‘å­˜å‚¨æœåŠ¡ï¼ˆå¦‚ AWS S3ã€é˜¿é‡Œäº‘ OSSï¼‰

2. **æµ‹è¯•æ¢å¤**
   - å®šæœŸæµ‹è¯•å¤‡ä»½æ¢å¤æµç¨‹
   - ç¡®ä¿å¤‡ä»½æ–‡ä»¶å¯ç”¨

3. **ç›‘æ§å¤‡ä»½**
   - ç›‘æ§å¤‡ä»½æ—¥å¿—
   - è®¾ç½®å¤‡ä»½å¤±è´¥å‘Šè­¦

4. **ç‰ˆæœ¬æ§åˆ¶**
   - é‡è¦æ›´æ–°å‰æ‰‹åŠ¨å¤‡ä»½
   - ä¿ç•™å…³é”®ç‰ˆæœ¬çš„å¤‡ä»½

## ğŸ“ ç›¸å…³å‘½ä»¤é€ŸæŸ¥

```bash
# æ‰‹åŠ¨å¤‡ä»½
./backup.sh

# æ‰‹åŠ¨æ¢å¤
./restore.sh

# æŸ¥çœ‹å¤‡ä»½åˆ—è¡¨
ls -lh backups/

# æŸ¥çœ‹å®šæ—¶ä»»åŠ¡
crontab -l

# ç¼–è¾‘å®šæ—¶ä»»åŠ¡
crontab -e

# æŸ¥çœ‹å¤‡ä»½æ—¥å¿—
tail -f backups/backup.log

# æµ‹è¯•å¤‡ä»½è„šæœ¬ï¼ˆä¸å®é™…æ‰§è¡Œï¼‰
bash -x backup.sh

# ä¸‹è½½å¤‡ä»½åˆ°æœ¬åœ°
scp user@server:/path/to/backups/backup_*.tar.gz ./
```
