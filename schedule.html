<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â§ßÊ®°ÂûãÊäÄÊúØÂõ¢ÈòüÁ†îÂèëÁü•ËØÜÂàÜ‰∫´ÊéíÁè≠Ë°® (2025-2026)</title>

    <!-- Distinctive Typography: Playfair Display + Outfit + JetBrains Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600;700&family=Playfair+Display:wght@500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           DESIGN SYSTEM: Modern Editorial Bright
           Aesthetic: Vibrant editorial style with warm, energetic tones
           Typography: Playfair Display (display) + Outfit (body) + JetBrains Mono (data)
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

        :root {
            /* Core Colors - Warm & Bright Palette */
            --bg-primary: #fef9f3;
            --bg-secondary: #fffbf5;
            --bg-tertiary: #fff5eb;
            --bg-elevated: #ffffff;

            /* Accent - Vibrant Coral & Orange */
            --accent-primary: #ff6b35;
            --accent-secondary: #f7931e;
            --accent-glow: rgba(255, 107, 53, 0.25);
            --accent-subtle: rgba(255, 107, 53, 0.08);

            /* Text Hierarchy */
            --text-primary: #1a1a1a;
            --text-secondary: #525252;
            --text-tertiary: #737373;
            --text-inverse: #ffffff;

            /* Status Colors - Vibrant & Clear */
            --status-done: #10b981;
            --status-done-bg: rgba(16, 185, 129, 0.12);
            --status-current: #ff6b35;
            --status-current-bg: rgba(255, 107, 53, 0.12);
            --status-holiday: #8b5cf6;
            --status-holiday-bg: rgba(139, 92, 246, 0.1);

            /* Person Colors - Vibrant & Distinct */
            --person-1: #ef4444;  /* Áè≠Êñ∞Âçö - Bright Red */
            --person-2: #f59e0b;  /* Èæö‰∏Ω - Amber */
            --person-3: #06b6d4;  /* Êùé‰Ω≥Êôü - Cyan */
            --person-4: #ec4899;  /* Ëß£ÂãáÂÆù - Pink */
            --person-5: #3b82f6;  /* Âè∂ÁéÆ‰Ω≥ - Blue */

            /* Borders & Lines */
            --border-subtle: rgba(0, 0, 0, 0.08);
            --border-medium: rgba(0, 0, 0, 0.15);
            --border-accent: var(--accent-primary);

            /* Typography */
            --font-display: 'Playfair Display', Georgia, serif;
            --font-body: 'Outfit', -apple-system, sans-serif;
            --font-mono: 'JetBrains Mono', 'Fira Code', monospace;

            /* Spacing Scale */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;

            /* Radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 28px;

            /* Shadows */
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 12px 40px rgba(0, 0, 0, 0.12);
            --shadow-glow: 0 0 40px var(--accent-glow);
        }

        /* 1. BASE STYLES & LAYOUT */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-body);
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
            position: relative;
            overflow-x: hidden;

            /* Vibrant gradient background */
            background: linear-gradient(135deg, #fef9f3 0%, #fff5eb 50%, #fffbf5 100%);
            background-attachment: fixed;
        }

        body::before {
            content: '';
            position: fixed;
            top: -50%;
            right: -20%;
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(255, 107, 53, 0.15), transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            animation: float 20s ease-in-out infinite;
        }

        body::after {
            content: '';
            position: fixed;
            bottom: -40%;
            left: -10%;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(247, 147, 30, 0.12), transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            animation: float 15s ease-in-out infinite reverse;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -30px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
        }

        .container {
            max-width: 1700px;
            margin: 0 auto;
            padding: var(--space-lg);
            animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 1;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 2. HEADER / TITLE */
        .page-header {
            text-align: center;
            margin-bottom: var(--space-2xl);
            padding: var(--space-2xl) 0;
            position: relative;
            animation: slideDown 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 4px;
            background: linear-gradient(90deg, transparent, var(--accent-primary), var(--accent-secondary), transparent);
            border-radius: 2px;
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        h1 {
            font-family: var(--font-display);
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 800;
            color: var(--text-primary);
            letter-spacing: -0.03em;
            margin-bottom: var(--space-md);
            line-height: 1.2;
            text-shadow: 0 2px 10px rgba(255, 107, 53, 0.1);
        }

        h1 .accent {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-style: italic;
        }

        .page-subtitle {
            font-family: var(--font-mono);
            font-size: clamp(0.8rem, 2vw, 1rem);
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.2em;
            font-weight: 500;
        }

        /* 3. INFO CARD */
        .info-card {
            background: var(--bg-elevated);
            border: 2px solid var(--border-subtle);
            border-left: 5px solid var(--accent-primary);
            padding: var(--space-lg) var(--space-xl);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-xl);
            font-size: 1rem;
            color: var(--text-secondary);
            line-height: 1.8;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;
        }

        .info-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--accent-primary);
        }

        .info-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary), transparent);
        }

        .info-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 53, 0.03));
            pointer-events: none;
        }

        .info-card strong {
            color: var(--accent-primary);
            font-weight: 700;
        }

        /* 4. MESSAGE BOARD SECTION */
        .message-board {
            margin-bottom: var(--space-xl);
            background: var(--bg-elevated);
            border: 2px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.25s both;
        }

        .message-board-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
        }

        .message-section,
        .notice-section {
            padding: var(--space-xl);
            position: relative;
        }

        .message-section {
            border-right: 2px solid var(--border-subtle);
        }

        .message-section h3,
        .notice-section h3 {
            font-family: var(--font-display);
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-lg);
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .message-section h3::before {
            content: 'üìã';
            font-size: 1.6rem;
        }

        .notice-section h3::before {
            content: 'üì¢';
            font-size: 1.6rem;
        }

        /* ÂèçÈ¶àË°®Ê†ºÊ†∑Âºè */
        .feedback-table-container {
            background: var(--bg-tertiary);
            border: 2px solid var(--border-subtle);
            border-radius: var(--radius-md);
            overflow: hidden;
            height: 400px;
            display: flex;
            flex-direction: column;
        }

        .feedback-table-wrapper {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .feedback-table-wrapper::-webkit-scrollbar {
            width: 6px;
        }

        .feedback-table-wrapper::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }

        .feedback-table-wrapper::-webkit-scrollbar-thumb {
            background: var(--border-medium);
            border-radius: 3px;
        }

        .feedback-table-wrapper::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }

        .feedback-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .feedback-table th,
        .feedback-table td {
            padding: var(--space-sm) var(--space-md);
            text-align: left;
            border-bottom: 1px solid var(--border-subtle);
        }

        .feedback-table th {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            color: var(--text-primary);
            font-family: var(--font-mono);
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            white-space: nowrap;
        }

        .feedback-table tbody tr {
            transition: all 0.2s ease;
        }

        .feedback-table tbody tr:hover {
            background: var(--bg-elevated);
        }

        .feedback-table tbody tr:last-child td {
            border-bottom: none;
        }

        .feedback-table td {
            vertical-align: middle;
        }

        /* Â∫èÂè∑„ÄÅÊó•ÊúüÂíåÂÆåÊàêÁä∂ÊÄÅÂàó‰∏çÊç¢Ë°å */
        .feedback-table td:nth-child(1),
        .feedback-table td:nth-child(2),
        .feedback-table td:nth-child(5) {
            white-space: nowrap;
        }

        /* ÂèØÁºñËæëÂçïÂÖÉÊ†º */
        .feedback-table .editable-cell {
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 4px;
            transition: all 0.2s ease;
            min-height: 32px;
        }

        .feedback-table .editable-cell:hover {
            background: var(--accent-subtle);
        }

        .feedback-table .editable-cell input,
        .feedback-table .editable-cell select {
            width: 100%;
            padding: 6px 8px;
            border: 2px solid var(--accent-primary);
            border-radius: 4px;
            font-family: var(--font-body);
            font-size: 0.9rem;
            background: var(--bg-elevated);
            color: var(--text-primary);
            outline: none;
        }

        .feedback-table .editable-cell input:focus,
        .feedback-table .editable-cell select:focus {
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        /* ÈóÆÈ¢òÁßçÁ±ªÊ†áÁ≠æ */
        .category-tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .category-tag.ÊúçÂä°‰ºòÂåñ { background: #dbeafe; color: #1d4ed8; }
        .category-tag.ÂäüËÉΩÂª∫ËÆÆ { background: #dcfce7; color: #15803d; }
        .category-tag.BugÂèçÈ¶à { background: #fee2e2; color: #dc2626; }
        .category-tag.‰ΩøÁî®ÈóÆÈ¢ò { background: #fef3c7; color: #d97706; }
        .category-tag.ÂÖ∂‰ªñ { background: #f3e8ff; color: #7c3aed; }

        /* ÂÆåÊàêÁä∂ÊÄÅ */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .status-badge.pending {
            background: #fef3c7;
            color: #d97706;
        }

        .status-badge.completed {
            background: #dcfce7;
            color: #15803d;
        }

        .status-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        /* Âà†Èô§ÊåâÈíÆ */
        .delete-feedback-btn {
            background: transparent;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 1.1rem;
            transition: all 0.2s ease;
        }

        .delete-feedback-btn:hover {
            background: #fee2e2;
            color: #dc2626;
        }

        /* Ê∑ªÂä†ÊåâÈíÆ */
        .add-feedback-btn {
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            background: var(--bg-elevated);
            border: 2px dashed var(--border-medium);
            border-top: none;
            color: var(--text-secondary);
            font-family: var(--font-body);
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 0 0 var(--radius-md) var(--radius-md);
            flex-shrink: 0;
        }

        .add-feedback-btn:hover {
            background: var(--accent-subtle);
            color: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        /* Á©∫Áä∂ÊÄÅ */
        .feedback-empty {
            text-align: center;
            padding: var(--space-xl);
            color: var(--text-tertiary);
            font-style: italic;
        }

        /* ÂèçÈ¶àÁªüËÆ°Ê†∑Âºè */
        .feedback-stats {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }

        .feedback-stat-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .feedback-stat-item.total {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(59, 130, 246, 0.08));
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #3b82f6;
        }

        .feedback-stat-item.completed {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.08));
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #10b981;
        }

        .feedback-stat-item.pending {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(245, 158, 11, 0.08));
            border: 1px solid rgba(245, 158, 11, 0.3);
            color: #f59e0b;
        }

        .feedback-stat-item .stat-label {
            font-family: var(--font-body);
            font-weight: 500;
        }

        .feedback-stat-item .stat-value {
            font-family: var(--font-mono);
            font-weight: 700;
            font-size: 1rem;
            min-width: 24px;
            text-align: center;
        }

        /* Â∫èÂè∑ÂàóÊ†∑Âºè */
        .feedback-table td.seq-num {
            text-align: center;
            font-family: var(--font-mono);
            font-weight: 600;
            color: var(--text-tertiary);
        }

        .message-content,
        .notice-content {
            height: 400px;
            padding: var(--space-lg);
            background: var(--bg-tertiary);
            border: 2px solid var(--border-subtle);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            line-height: 1.8;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .message-content::-webkit-scrollbar,
        .notice-content::-webkit-scrollbar {
            width: 6px;
        }

        .message-content::-webkit-scrollbar-track,
        .notice-content::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }

        .message-content::-webkit-scrollbar-thumb,
        .notice-content::-webkit-scrollbar-thumb {
            background: var(--border-medium);
            border-radius: 3px;
        }

        .message-content::-webkit-scrollbar-thumb:hover,
        .notice-content::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }

        .message-content:hover,
        .notice-content:hover {
            background: var(--bg-elevated);
            border-color: var(--accent-primary);
            box-shadow: var(--shadow-sm);
        }

        .message-content::after,
        .notice-content::after {
            content: '‚úé ÁÇπÂáªÁºñËæë';
            position: absolute;
            bottom: 8px;
            right: 12px;
            font-family: var(--font-mono);
            font-size: 0.7rem;
            color: var(--accent-primary);
            opacity: 0;
            transition: all 0.3s ease;
            background: var(--bg-elevated);
            padding: 4px 10px;
            border-radius: var(--radius-sm);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            font-weight: 600;
        }

        .message-content:hover::after,
        .notice-content:hover::after {
            opacity: 1;
        }

        .message-content.editing,
        .notice-content.editing {
            background: var(--bg-elevated);
            border-color: var(--accent-primary);
            box-shadow: inset 0 0 0 3px var(--accent-glow);
        }

        .message-content textarea,
        .notice-content textarea {
            width: 100%;
            height: 300px;
            padding: var(--space-md);
            border: none;
            outline: none;
            resize: none;
            font-family: var(--font-body);
            font-size: 0.95rem;
            line-height: 1.8;
            background: transparent;
            color: var(--text-primary);
        }

        .message-content.empty,
        .notice-content.empty {
            color: var(--text-tertiary);
            font-style: italic;
        }

        @media screen and (max-width: 768px) {
            .message-board-grid {
                grid-template-columns: 1fr;
            }

            .message-section {
                border-right: none;
                border-bottom: 2px solid var(--border-subtle);
            }

            .message-section,
            .notice-section {
                padding: var(--space-lg);
            }
        }

        /* 5. STATS SECTION */
        .stats-container {
            margin-bottom: var(--space-xl);
            padding: var(--space-xl);
            background: var(--bg-elevated);
            border: 2px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            position: relative;
            box-shadow: var(--shadow-md);
            overflow: hidden;
            animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.3s both;
        }

        .stats-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -10%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255, 107, 53, 0.08), transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }

        .stats-container h2 {
            font-family: var(--font-display);
            font-size: clamp(1.4rem, 3vw, 1.8rem);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-lg);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            position: relative;
            z-index: 1;
        }

        .stats-container h2::before {
            content: '';
            display: inline-block;
            width: 5px;
            height: 28px;
            background: linear-gradient(180deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 3px;
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.3);
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-lg);
            position: relative;
            z-index: 1;
        }

        .stat-card {
            background: var(--bg-tertiary);
            border: 2px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) both;
        }

        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.2s; }
        .stat-card:nth-child(3) { animation-delay: 0.3s; }
        .stat-card:nth-child(4) { animation-delay: 0.4s; }
        .stat-card:nth-child(5) { animation-delay: 0.5s; }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--card-accent, var(--accent-primary)), transparent);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .stat-card::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, var(--accent-glow), transparent 70%);
            opacity: 0;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }

        .stat-card:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: var(--shadow-lg);
            border-color: var(--card-accent, var(--accent-primary));
            background: var(--bg-elevated);
        }

        .stat-card:hover::before {
            height: 100%;
            opacity: 0.1;
        }

        .stat-card:hover::after {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }

        .stat-card .name {
            font-family: var(--font-display);
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--card-accent, var(--text-primary));
            margin-bottom: var(--space-md);
            padding-bottom: var(--space-sm);
            border-bottom: 2px solid var(--border-subtle);
            position: relative;
            z-index: 1;
        }

        .stat-card .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-sm);
            font-size: 0.9rem;
            position: relative;
            z-index: 1;
        }

        .stat-card .stat-row .label {
            color: var(--text-secondary);
            font-family: var(--font-mono);
            font-size: 0.75rem;
            font-weight: 500;
        }

        .stat-card .stat-row .value {
            font-family: var(--font-mono);
            font-weight: 700;
            color: var(--text-primary);
            background: var(--bg-elevated);
            padding: 4px 12px;
            border-radius: var(--radius-sm);
            min-width: 32px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .stat-card:hover .stat-row .value {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .stat-card .total-row {
            margin-top: var(--space-md);
            padding-top: var(--space-md);
            border-top: 2px dashed var(--border-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .stat-card .total-row .label {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .stat-card .total-row .value {
            font-family: var(--font-mono);
            font-weight: 800;
            background: linear-gradient(135deg, var(--card-accent, var(--accent-primary)), var(--accent-secondary));
            color: var(--text-inverse);
            padding: 6px 18px;
            border-radius: var(--radius-sm);
            font-size: 1.1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }

        .stat-card:hover .total-row .value {
            transform: scale(1.15);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
        }

        /* Person-specific card colors */
        .stat-card.p-Áè≠Êñ∞Âçö { --card-accent: var(--person-1); }
        .stat-card.p-Èæö‰∏Ω { --card-accent: var(--person-2); }
        .stat-card.p-Êùé‰Ω≥Êôü { --card-accent: var(--person-3); }
        .stat-card.p-Ëß£ÂãáÂÆù { --card-accent: var(--person-4); }
        .stat-card.p-Âè∂ÁéÆ‰Ω≥ { --card-accent: var(--person-5); }

        /* 6. DOCUMENT LIBRARY */
        .document-library {
            margin-bottom: var(--space-xl);
            padding: var(--space-xl);
            background: var(--bg-elevated);
            border: 2px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            position: relative;
            box-shadow: var(--shadow-md);
            overflow: hidden;
            animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.35s both;
        }

        .document-library::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(6, 182, 212, 0.08), transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }

        .library-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            gap: var(--space-lg);
            position: relative;
            z-index: 1;
            flex-wrap: wrap;
        }

        .library-header h2 {
            font-family: var(--font-display);
            font-size: clamp(1.4rem, 3vw, 1.8rem);
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin: 0;
        }

        .library-icon {
            font-size: 1.8rem;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .library-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: var(--space-md);
            flex-wrap: wrap;
        }

        .library-controls .control-left,
        .library-controls .control-right {
            display: flex;
            gap: var(--space-md);
            align-items: center;
            flex-wrap: wrap;
        }

        .file-search-input {
            padding: var(--space-sm) var(--space-md);
            border: 2px solid var(--border-subtle);
            border-radius: var(--radius-md);
            font-family: var(--font-body);
            font-size: 0.95rem;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 200px;
        }

        .file-search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-glow);
            background: var(--bg-elevated);
        }

        .file-search-input::placeholder {
            color: var(--text-tertiary);
        }

        .file-sort-select {
            padding: var(--space-sm) var(--space-md);
            border: 2px solid var(--border-subtle);
            border-radius: var(--radius-md);
            font-family: var(--font-body);
            font-size: 0.95rem;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .file-sort-select:hover {
            border-color: var(--accent-primary);
        }

        .file-sort-select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .library-stats {
            padding: var(--space-md) var(--space-lg);
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-lg);
            position: relative;
            z-index: 1;
        }

        .total-files {
            font-family: var(--font-body);
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        .total-files strong {
            color: var(--accent-primary);
            font-weight: 700;
            font-size: 1.1rem;
        }

        .document-library-content {
            position: relative;
            z-index: 1;
            max-height: 600px;
            overflow-y: auto;
            padding-right: var(--space-sm);
        }

        /* Ëá™ÂÆö‰πâÊªöÂä®Êù°Ê†∑Âºè */
        .document-library-content::-webkit-scrollbar {
            width: 8px;
        }

        .document-library-content::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
        }

        .document-library-content::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: var(--radius-sm);
            transition: background 0.3s ease;
        }

        .document-library-content::-webkit-scrollbar-thumb:hover {
            background: var(--accent-secondary);
        }

        .loading-spinner {
            text-align: center;
            padding: var(--space-2xl);
            color: var(--text-tertiary);
            font-size: 1rem;
        }

        .document-list {
            display: grid;
            gap: var(--space-md);
        }

        .document-item {
            display: grid;
            grid-template-columns: 40px 1fr auto auto;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-lg);
            background: var(--bg-tertiary);
            border: 2px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) both;
        }

        .document-item:hover {
            border-color: var(--accent-primary);
            box-shadow: var(--shadow-md);
            transform: translateX(4px);
        }

        .document-icon {
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .document-info {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }

        .document-name {
            font-family: var(--font-body);
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            word-break: break-all;
        }

        .document-meta {
            display: flex;
            gap: var(--space-md);
            flex-wrap: wrap;
            font-size: 0.85rem;
            color: var(--text-tertiary);
        }

        .document-meta span {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .document-meta-item {
            font-family: var(--font-mono);
            padding: 2px 8px;
            background: rgba(255, 107, 53, 0.1);
            border-radius: 4px;
            color: var(--accent-primary);
        }

        .document-size {
            font-family: var(--font-mono);
            color: var(--text-tertiary);
        }

        .document-actions {
            display: flex;
            gap: var(--space-sm);
        }

        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-sm) var(--space-lg);
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: var(--text-inverse);
            border: none;
            border-radius: var(--radius-md);
            font-family: var(--font-body);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
            text-decoration: none;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
        }

        .download-btn:active {
            transform: translateY(0);
        }

        .refresh-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-sm) var(--space-lg);
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: var(--text-inverse);
            border: none;
            border-radius: var(--radius-md);
            font-family: var(--font-body);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(6, 182, 212, 0.3);
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.4);
        }

        .refresh-btn:active {
            transform: translateY(0);
        }

        .refresh-btn.refreshing {
            opacity: 0.7;
            cursor: not-allowed;
            pointer-events: none;
        }

        .refresh-btn.refreshing::after {
            content: '';
            width: 14px;
            height: 14px;
            border: 2px solid var(--text-inverse);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Â§çÈÄâÊ°ÜÊ†∑Âºè */
        .document-checkbox {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
        }

        .file-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--accent-primary);
        }

        .file-checkbox:hover {
            transform: scale(1.1);
        }

        /* ÂÖ®ÈÄâÊ†áÁ≠æÊ†∑Âºè */
        .select-all-label {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text-secondary);
            user-select: none;
        }

        .select-all-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--accent-primary);
        }

        .select-all-label:hover {
            color: var(--text-primary);
        }

        /* ÊâπÈáè‰∏ãËΩΩÊåâÈíÆÊ†∑Âºè */
        .batch-download-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-sm) var(--space-lg);
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: var(--text-inverse);
            border: none;
            border-radius: var(--radius-md);
            font-family: var(--font-body);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
        }

        .batch-download-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
        }

        .batch-download-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .batch-download-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* ÊñáÊ°£È°πÊ†∑ÂºèË∞ÉÊï¥ÔºàÊ∑ªÂä†Â§çÈÄâÊ°ÜÂàóÔºâ */
        .document-item {
            display: grid;
            grid-template-columns: 40px 40px 1fr auto;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-lg);
            margin-bottom: var(--space-sm);
            background: var(--bg-secondary);
            border: 2px solid var(--border-subtle);
            border-radius: var(--radius-md);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ÂàÜÈ°µÊéß‰ª∂Ê†∑Âºè */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-xs);
            margin-top: var(--space-lg);
            padding: var(--space-md);
            flex-wrap: wrap;
        }

        .pagination-btn {
            padding: var(--space-xs) var(--space-md);
            background: var(--bg-secondary);
            border: 2px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-family: var(--font-body);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination-btn:hover:not(:disabled) {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: var(--text-inverse);
        }

        .pagination-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .pagination-btn.active {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-color: var(--accent-primary);
            color: var(--text-inverse);
            font-weight: 600;
        }

        .pagination-info {
            margin-left: var(--space-md);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .empty-state {
            text-align: center;
            padding: var(--space-2xl);
            color: var(--text-tertiary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: var(--space-md);
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 1.1rem;
            margin-bottom: var(--space-sm);
        }

        .empty-state-subtext {
            font-size: 0.9rem;
            color: var(--text-tertiary);
        }

        @media (max-width: 768px) {
            .library-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .library-controls {
                width: 100%;
            }

            .library-controls .control-left,
            .library-controls .control-right {
                width: 100%;
            }

            .file-search-input {
                flex: 1;
            }

            .document-item {
                grid-template-columns: 40px 40px 1fr;
                gap: var(--space-sm);
            }

            .document-actions {
                grid-column: 3;
                justify-content: flex-start;
                width: 100%;
            }
        }

        /* 7. TABLE CONTAINER */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            background: var(--bg-elevated);
            border: 2px solid var(--border-subtle);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.4s both;
        }

        .schedule-table {
            width: 100%;
            min-width: 800px;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        .schedule-table th,
        .schedule-table td {
            padding: var(--space-md) var(--space-lg);
            text-align: left;
            vertical-align: middle;
            border-bottom: 1px solid var(--border-subtle);
        }

        .schedule-table th {
            background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary));
            color: var(--text-primary);
            font-family: var(--font-mono);
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            position: sticky;
            top: 0;
            z-index: 10;
            white-space: nowrap;
        }

        .schedule-table th::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary), transparent);
            opacity: 0.5;
        }

        .schedule-table tbody tr {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .schedule-table tbody tr:hover:not(.status-holiday) {
            background: var(--accent-subtle);
            transform: scale(1.005);
        }

        /* Â∫èÂè∑ÂíåÊó•ÊúüÂàó‰∏çÊç¢Ë°å */
        .schedule-table td:nth-child(1),
        .schedule-table td:nth-child(2) {
            white-space: nowrap;
        }

        .schedule-table td:nth-child(1) {
            min-width: 50px;
            text-align: center;
            font-weight: 600;
        }

        .schedule-table td:nth-child(2) {
            min-width: 110px;
        }

        /* Âú∞ÁÇπ/Êó∂Èó¥Âàó */
        .schedule-table td:nth-child(3) {
            min-width: 100px;
        }

        /* ‰∏ªÈ¢òÂàó - Êõ¥ÂÆΩ */
        .schedule-table td:nth-child(4) {
            min-width: 280px;
            max-width: 400px;
        }

        /* Êñá‰ª∂Âàó */
        .schedule-table td:nth-child(5) {
            min-width: 180px;
        }

        /* Â§áÊ≥®Âàó */
        .schedule-table td:nth-child(6) {
            min-width: 180px;
            max-width: 280px;
        }

        /* ÂÆåÊàêÊÉÖÂÜµÂàó */
        .schedule-table td:nth-child(7) {
            min-width: 160px;
        }

        /* 6. STATUS STYLES */
        .status-done {
            background: var(--status-done-bg) !important;
            border-left: 4px solid var(--status-done) !important;
        }

        .status-done:hover {
            background: rgba(16, 185, 129, 0.18) !important;
        }

        .status-holiday {
            background: var(--status-holiday-bg) !important;
            border-left: 4px solid var(--status-holiday) !important;
            opacity: 0.75;
        }

        .status-holiday td:first-child::before {
            content: '‰ºë';
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            margin-right: var(--space-sm);
            background: linear-gradient(135deg, var(--status-holiday), #a78bfa);
            color: white;
            font-size: 0.75rem;
            font-weight: 700;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
        }

        .status-current {
            background: var(--status-current-bg) !important;
            border-left: 4px solid var(--status-current) !important;
            position: relative;
        }

        .status-current::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, var(--accent-primary), var(--accent-secondary));
            animation: currentPulse 2s ease-in-out infinite;
            box-shadow: 0 0 15px var(--accent-primary);
        }

        @keyframes currentPulse {
            0%, 100% { opacity: 1; transform: scaleY(1); }
            50% { opacity: 0.7; transform: scaleY(0.95); }
        }

        /* 7. RESPONSIBLE CELL - Person Colors */
        .responsible-cell {
            font-family: var(--font-body);
            font-weight: 700;
            text-align: center;
            min-width: 75px;
            white-space: nowrap;
            font-size: 1rem;
        }

        .p-Áè≠Êñ∞Âçö {
            color: var(--person-1);
            text-shadow: 0 2px 8px rgba(239, 68, 68, 0.2);
        }
        .p-Èæö‰∏Ω {
            color: var(--person-2);
            text-shadow: 0 2px 8px rgba(245, 158, 11, 0.2);
        }
        .p-Êùé‰Ω≥Êôü {
            color: var(--person-3);
            text-shadow: 0 2px 8px rgba(6, 182, 212, 0.2);
        }
        .p-Ëß£ÂãáÂÆù {
            color: var(--person-4);
            text-shadow: 0 2px 8px rgba(236, 72, 153, 0.2);
        }
        .p-Âè∂ÁéÆ‰Ω≥ {
            color: var(--person-5);
            text-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
        }

        /* 8. EDITABLE CELLS */
        .editable {
            cursor: pointer;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 200px;
            border-radius: var(--radius-sm);
            padding: var(--space-sm) var(--space-md);
        }

        /* ‰∏ªÈ¢òÂàóÊõ¥ÂÆΩ */
        .editable.topic-link {
            min-width: 280px;
        }

        /* Â§áÊ≥®Âàó */
        .editable.remark-field {
            min-width: 180px;
        }

        /* Inline links in editable cells */
        .inline-link {
            color: var(--accent-primary);
            text-decoration: none;
            font-weight: 600;
            border-bottom: 2px solid var(--accent-primary);
            transition: all 0.3s ease;
            padding: 2px 4px;
            border-radius: 3px;
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(247, 147, 30, 0.1));
        }

        .inline-link:hover {
            color: var(--accent-secondary);
            border-bottom-color: var(--accent-secondary);
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(247, 147, 30, 0.2));
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
        }

        .inline-link:active {
            transform: translateY(0);
        }

        .editable:hover {
            background: linear-gradient(135deg, var(--accent-subtle), rgba(247, 147, 30, 0.05));
            box-shadow: inset 0 0 0 2px var(--accent-primary);
        }

        .editable::after {
            content: '‚úé ÁºñËæë';
            position: absolute;
            right: 8px;
            top: 8px;
            font-family: var(--font-mono);
            font-size: 0.7rem;
            color: var(--accent-primary);
            opacity: 0;
            transition: all 0.3s ease;
            background: var(--bg-elevated);
            padding: 3px 8px;
            border-radius: var(--radius-sm);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            font-weight: 600;
        }

        .editable:hover::after {
            opacity: 1;
            transform: translateY(-2px);
        }

        .editing {
            background: var(--bg-elevated) !important;
            box-shadow: inset 0 0 0 3px var(--accent-primary) !important;
            animation: editPulse 0.3s ease;
        }

        @keyframes editPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .editing textarea {
            width: 100%;
            min-width: 200px;
            padding: var(--space-md);
            border: none;
            outline: none;
            resize: vertical;
            font-family: var(--font-body);
            font-size: inherit;
            line-height: 1.6;
            min-height: 90px;
            background: transparent;
            color: var(--text-primary);
            border-radius: var(--radius-sm);
        }

        .editing textarea::placeholder {
            color: var(--text-tertiary);
            font-size: 0.9em;
        }

        /* 9. CHECKBOXES */
        .status-checkboxes {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            min-width: 120px;
        }

        .status-checkbox-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 0.9rem;
            padding: 6px 10px;
            border-radius: var(--radius-sm);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid transparent;
        }

        .status-checkbox-item:hover {
            background: var(--accent-subtle);
            border-color: var(--accent-primary);
            transform: translateX(3px);
        }

        .status-checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--status-done);
            flex-shrink: 0;
            border-radius: 4px;
        }

        .status-checkbox-item label {
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
            color: var(--text-secondary);
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .status-checkbox-item.checked {
            background: var(--status-done-bg);
            border-color: var(--status-done);
        }

        .status-checkbox-item.checked label {
            color: var(--status-done);
            text-decoration: line-through;
            font-weight: 600;
        }

        .status-checkbox-item .task-type {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            color: var(--text-tertiary);
            margin-left: 4px;
            padding: 2px 6px;
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        /* 10. LOCATION CELL */
        .location-cell,
        .location-field {
            text-align: center;
            white-space: nowrap;
        }

        .location-cell .room,
        .location-field .room {
            font-family: var(--font-mono);
            font-weight: 800;
            font-size: 1.1rem;
            color: var(--text-inverse);
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            padding: 6px 16px;
            border-radius: var(--radius-sm);
            display: inline-block;
            border: 2px solid transparent;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
            transition: all 0.3s ease;
        }

        .location-cell .room:hover,
        .location-field .room:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .location-cell .time,
        .location-field .time {
            font-family: var(--font-mono);
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 6px;
            font-weight: 600;
        }

        /* ÁºñËæëlocationÊó∂ÁöÑËæìÂÖ•Ê°ÜÊ†∑Âºè */
        .location-field.editing {
            text-align: left;
            padding: var(--space-md);
        }

        .editing-location,
        .editing-time {
            outline: none;
            transition: all 0.3s ease;
        }

        .editing-location:focus,
        .editing-time:focus {
            border-color: var(--accent-secondary) !important;
            box-shadow: 0 0 0 3px var(--accent-glow) !important;
        }

        /* 11. RESPONSIVE DESIGN */
        @media screen and (max-width: 1200px) {
            .container {
                padding: var(--space-md);
            }
        }

        @media screen and (max-width: 768px) {
            .container {
                padding: var(--space-sm);
            }

            .page-header {
                margin-bottom: var(--space-lg);
                padding: var(--space-md) 0;
            }

            h1 {
                font-size: 1.4rem;
            }

            .info-card {
                padding: var(--space-sm) var(--space-md);
                font-size: 0.8rem;
            }

            .stats-container {
                padding: var(--space-md);
            }

            .stats-cards {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: var(--space-sm);
            }

            .stat-card {
                padding: var(--space-sm);
            }

            .schedule-table {
                font-size: 0.85rem;
                min-width: 600px;
            }

            .schedule-table th,
            .schedule-table td {
                padding: var(--space-sm) var(--space-md);
            }

            .status-checkboxes {
                min-width: 120px;
            }

            .editable {
                min-width: 120px;
            }

            .editable.topic-link {
                min-width: 180px;
            }

            .editable::after {
                display: none;
            }

            .files-cell {
                min-width: 150px;
            }

            .file-upload-btn {
                padding: 6px 12px;
                font-size: 0.75rem;
            }

            .file-item {
                padding: 4px 8px;
            }

            .file-download {
                font-size: 0.75rem;
            }
        }

        @media screen and (max-width: 480px) {
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
            }

            .stat-card .stat-row .label {
                font-size: 0.65rem;
            }

            .schedule-table {
                font-size: 0.75rem;
                min-width: 500px;
            }

            .status-checkbox-item {
                font-size: 0.75rem;
            }

            .status-checkbox-item input[type="checkbox"] {
                width: 14px;
                height: 14px;
            }
        }

        /* 12. FILES CELL STYLES */
        .files-cell {
            min-width: 200px;
            max-width: 300px;
            padding: var(--space-md);
        }

        .files-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .files-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
            margin-bottom: var(--space-sm);
        }

        .file-item {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            padding: 6px 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .file-item:hover {
            background: var(--bg-elevated);
            border-color: var(--accent-primary);
            transform: translateX(2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .file-preview,
        .file-download {
            flex: 1;
            color: var(--accent-primary);
            text-decoration: none;
            font-family: var(--font-body);
            font-size: 0.85rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: all 0.3s ease;
        }

        .file-preview:hover,
        .file-download:hover {
            color: var(--accent-secondary);
            text-decoration: underline;
        }

        .file-size {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            color: var(--text-tertiary);
            white-space: nowrap;
            margin-left: auto;
        }

        .file-delete {
            width: 20px;
            height: 20px;
            border: none;
            background: transparent;
            color: var(--text-tertiary);
            cursor: pointer;
            font-size: 1.2rem;
            line-height: 1;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .file-delete:hover {
            background: #dc2626;
            color: white;
            transform: scale(1.1);
        }

        .file-upload-wrapper {
            display: flex;
            justify-content: center;
        }

        .file-upload-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-family: var(--font-body);
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .file-upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
        }

        .file-upload-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(255, 107, 53, 0.3);
        }

        /* ‰∏ä‰º†ËøõÂ∫¶Êù°Ê†∑Âºè */
        .file-item.uploading {
            background: var(--bg-elevated);
            border-color: var(--accent-primary);
        }

        .file-progress-container {
            margin-top: 4px;
            width: 100%;
        }

        .file-progress-bar {
            width: 100%;
            height: 4px;
            background: var(--border-subtle);
            border-radius: 2px;
            overflow: hidden;
            position: relative;
        }

        .file-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 2px;
            transition: width 0.3s ease;
            box-shadow: 0 0 8px rgba(255, 107, 53, 0.5);
        }

        .file-progress-text {
            font-family: var(--font-mono);
            font-size: 0.65rem;
            color: var(--accent-primary);
            margin-top: 2px;
            font-weight: 600;
        }

        /* 13. PRINT STYLES */
        @media print {
            body {
                background: white;
                color: black;
            }

            body::before,
            body::after {
                display: none;
            }

            .container {
                box-shadow: none;
                padding: 10px;
            }

            .schedule-table th {
                background: linear-gradient(135deg, #f5f5f5, #e5e5e5) !important;
                color: #1a1a1a !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .status-done,
            .status-current,
            .status-holiday {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .status-holiday td:first-child::before {
                content: '[‰ºë]';
                background: #8b5cf6 !important;
                color: white !important;
            }

            .editable::after {
                display: none;
            }

            .stat-card:hover,
            .location-cell .room:hover,
            .location-field .room:hover {
                transform: none;
            }
        }

        /* 14. LOADING & NOTIFICATIONS */
        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            padding: var(--space-lg) var(--space-xl);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            max-width: 360px;
            font-size: 1rem;
            animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(120%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.error {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            border-color: #991b1b;
        }

        .notification.success {
            background: linear-gradient(135deg, var(--status-done), #059669);
            color: white;
            border-color: #047857;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(254, 249, 243, 0.95);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            animation: fadeIn 0.3s ease;
        }

        .loading-spinner {
            width: 56px;
            height: 56px;
            border: 4px solid var(--border-subtle);
            border-top-color: var(--accent-primary);
            border-right-color: var(--accent-secondary);
            border-radius: 50%;
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite;
            box-shadow: 0 0 30px rgba(255, 107, 53, 0.3);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }


        /* === ÂÜÖËÅîÊñá‰ª∂È¢ÑËßàÊ†∑Âºè === */
        .file-preview-section {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .file-preview-header-inline {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-lg) var(--space-xl);
            border-bottom: 2px solid var(--border-subtle);
            background: var(--bg-secondary);
            flex-shrink: 0;
        }

        .file-preview-title-inline {
            flex: 1;
            min-width: 0;
            margin-right: var(--space-md);
        }

        .file-preview-actions {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .file-preview-download-btn-inline {
            padding: var(--space-sm) var(--space-lg);
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-preview-download-btn-inline:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
        }

        .file-preview-title-inline h3 {
            margin: 0 0 var(--space-xs) 0;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-preview-info-inline {
            font-size: 0.8rem;
            color: var(--text-tertiary);
            font-family: var(--font-mono);
        }

        .file-preview-close-inline {
            background: transparent;
            border: none;
            color: var(--text-tertiary);
            font-size: 1.5rem;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .file-preview-close-inline:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transform: rotate(90deg);
        }

        .file-preview-content-inline {
            flex: 1;
            overflow: auto;
            padding: var(--space-lg) var(--space-xl);
            background: var(--bg-primary);
        }

        .image-preview-inline {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .image-preview-inline img {
            max-width: 100%;
            max-height: 80vh;
            height: auto;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
            object-fit: contain;
        }

        .pdf-preview-inline {
            width: 100%;
            height: calc(100vh - 120px);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pdf-preview-inline iframe {
            width: 100%;
            height: 100%;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
        }

        .text-preview-inline {
            width: 100%;
            height: 100%;
            overflow: auto;
        }

        .text-preview-inline pre {
            margin: 0;
            padding: var(--space-lg);
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
            color: var(--text-primary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>

<div class="container">
    <header class="page-header">
        <h1>ÁßëÁ†î‰∏≠ÂøÉÂ§ßÊ®°ÂûãÊäÄÊúØÂõ¢Èòü<span class="accent">Áü•ËØÜÂàÜ‰∫´</span>Ë°®<span class="accent">(2025-2026)</span></h1>
        <p class="page-subtitle">Team Knowledge Sharing Schedule</p>
    </header>

    <div class="info-card">
        **üí° ÊéíÁè≠ËØ¥ÊòéÔºö** ÊéíÁè≠Âõ∫ÂÆöÂú®ÊØèÂë®‰∫îÔºåÈÅáÂà∞Ê≥ïÂÆöËäÇÂÅáÊó•Âàô‰ªªÂä°ËßÜÂÖ∑‰ΩìÊÉÖÂÜµËÄåÂÆö„ÄÇ
        <br>
        **üíª ÂèØÁºñËæëËØ¥ÊòéÔºö** ÂèåÂáªË°®Ê†º‰∏≠"‰∏ªÈ¢ò"„ÄÅ"Â§áÊ≥®"ÂàóÁöÑÂçïÂÖÉÊ†ºÂç≥ÂèØÁºñËæëÔºàÊîØÊåÅÊç¢Ë°åÔºåOption/Shift+EnterÊç¢Ë°åÔºåEnter‰øùÂ≠òÔºâ„ÄÇÂÜÖÂÆπ‰ºöËá™Âä®‰øùÂ≠òÂú®ÊÇ®ÁöÑÊµèËßàÂô®‰∏≠„ÄÇ
    </div>

    <!-- ÁïôË®ÄÊùøÂå∫Âüü -->
    <div class="message-board">
        <div class="message-board-grid">
            <div class="message-section">
                <h3>ÈóÆÈ¢òÂèçÈ¶à</h3>
                <!-- ÁªüËÆ°Âå∫Âüü -->
                <div class="feedback-stats" id="feedbackStats">
                    <div class="feedback-stat-item total">
                        <span class="stat-label">ÊÄªËÆ°</span>
                        <span class="stat-value" id="feedbackTotal">0</span>
                    </div>
                    <div class="feedback-stat-item completed">
                        <span class="stat-label">Â∑≤ÂÆåÊàê</span>
                        <span class="stat-value" id="feedbackCompleted">0</span>
                    </div>
                    <div class="feedback-stat-item pending">
                        <span class="stat-label">ÂæÖÂ§ÑÁêÜ</span>
                        <span class="stat-value" id="feedbackPending">0</span>
                    </div>
                </div>
                <div class="feedback-table-container">
                    <div class="feedback-table-wrapper">
                        <table class="feedback-table">
                            <thead>
                                <tr>
                                    <th style="width: 50px;">#</th>
                                    <th style="width: 110px;">Êó•Êúü</th>
                                    <th style="width: 110px;">ÈóÆÈ¢òÁßçÁ±ª</th>
                                    <th style="min-width: 300px;">ÁÆÄË¶ÅÊèèËø∞</th>
                                    <th style="width: 90px;">ÂÆåÊàêÁä∂ÊÄÅ</th>
                                    <th style="width: 50px;">Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="feedbackBody">
                                <!-- ÁïôË®ÄÊï∞ÊçÆÁî±JSÂä®ÊÄÅÁîüÊàê -->
                            </tbody>
                        </table>
                    </div>
                    <button class="add-feedback-btn" id="addFeedbackBtn">+ Ê∑ªÂä†ÂèçÈ¶à</button>
                </div>
            </div>
            <div class="notice-section">
                <h3>ÈáçË¶ÅÂÖ¨Âëä</h3>
                <div id="noticeContent" class="notice-content empty" data-type="notice">
                    ÁÇπÂáªÊ≠§Â§ÑÂèëÂ∏ÉÂÖ¨Âëä...
                </div>
            </div>
        </div>
    </div>

    <!-- ÁªüËÆ°ÂèØËßÜÂåñÂå∫Âüü -->
    <div class="stats-container">
        <h2>Â∑≤ÂÆåÊàêÂàÜ‰∫´ÁªüËÆ°</h2>
        <div id="statsCards" class="stats-cards">
            <!-- ÁªüËÆ°Âç°ÁâáÂ∞ÜÁî±JSÂä®ÊÄÅÁîüÊàê -->
        </div>
    </div>

    <!-- ÊñáÊ°£Â∫ìÂå∫Âüü -->
    <div class="document-library">
        <div class="library-header">
            <h2>
                <span class="library-icon">üìö</span>
                ÂàÜ‰∫´ÊñáÊ°£Â∫ì
            </h2>
            <div class="library-controls">
                <div class="control-left">
                    <input type="text" id="fileSearchInput" class="file-search-input" placeholder="ÊêúÁ¥¢Êñá‰ª∂Âêç...">
                    <select id="fileSortSelect" class="file-sort-select">
                        <option value="date-desc">‰∏ä‰º†Êó∂Èó¥ (ÊúÄÊñ∞)</option>
                        <option value="date-asc">‰∏ä‰º†Êó∂Èó¥ (ÊúÄÊó©)</option>
                        <option value="name-asc">Êñá‰ª∂Âêç (A-Z)</option>
                        <option value="name-desc">Êñá‰ª∂Âêç (Z-A)</option>
                    </select>
                    <button id="refreshLibraryBtn" class="refresh-btn" title="Âà∑Êñ∞ÊñáÊ°£Â∫ì">
                        üîÑ Âà∑Êñ∞
                    </button>
                </div>
                <div class="control-right">
                    <label class="select-all-label">
                        <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()">
                        <span>ÂÖ®ÈÄâ</span>
                    </label>
                    <button id="batchDownloadBtn" class="batch-download-btn" onclick="batchDownload()" disabled>
                        üì¶ ÊâπÈáè‰∏ãËΩΩ (0)
                    </button>
                </div>
            </div>
        </div>
        <div class="library-stats">
            <span class="total-files">ÂÖ± <strong id="totalFilesCount">0</strong> ‰∏™Êñá‰ª∂</span>
        </div>
        <div id="documentLibraryContent" class="document-library-content">
            <div class="loading-spinner">Âä†ËΩΩ‰∏≠...</div>
        </div>
    </div>

    <div class="table-container">
        <table class="schedule-table">
            <thead>
                <tr class="header-row">
                    <th>#</th>
                    <th>Êó•Êúü</th>
                    <th>Âú∞ÁÇπ/Êó∂Èó¥</th>
                    <th>‰∏ªÈ¢ò & ÊñáÊ°£ÈìæÊé•</th>
                    <th>Êñá‰ª∂Ôºà‰∏çË∂ÖËøá50MÔºâ</th>
                    <th>Â§áÊ≥®</th>
                    <th>ÂÆåÊàêÊÉÖÂÜµ</th>
                </tr>
            </thead>
            <tbody id="scheduleBody">
            </tbody>
        </table>
    </div>
</div>

<script>
    // --- API ÈÖçÁΩÆ ---
    // Ëá™Âä®Ê£ÄÊµãÁéØÂ¢ÉÔºö
    // - Êú¨Âú∞ÂºÄÂèë: http://localhost:3000
    // - Â±ÄÂüüÁΩëËÆøÈóÆ: Ëá™Âä®‰ΩøÁî®ÂΩìÂâçËÆøÈóÆÁöÑIPÂú∞ÂùÄ + 3000Á´ØÂè£
    // - Áîü‰∫ßÁéØÂ¢É: Â¶ÇÈúÄÈÉ®ÁΩ≤Âà∞‰∫ëÊúçÂä°Âô®ÔºåËØ∑‰øÆÊîπ‰∏ãÈù¢ÁöÑÈÄªËæë
    const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
        ? 'http://localhost:3000'
        : `http://${window.location.hostname}:3000`;  // Ëá™Âä®‰ΩøÁî®ÂΩìÂâçhostname

    console.log('üîó API Base URL:', API_BASE_URL);
    console.log('üåê Current hostname:', window.location.hostname);

    // --- 1. Êï∞ÊçÆÂÆö‰πâÔºö2026Âπ¥ÂÖ®Âπ¥ÁöÑÊéíÁè≠‰ø°ÊÅØ ---
    let scheduleData = [
        // ===== 2025Âπ¥ (‰ªéExcelÂØºÂÖ•) =====
        {week: 1, date: "2025-11-28", T1: "Êùé‰Ω≥Êôü", T2_1: "Ëß£ÂãáÂÆù", T2_2: "Áè≠Êñ∞Âçö", T3: "", topic: "Â∑•ÂÖ∑ÔºöÁ£êÁü≥ScienceOne / Chain-of-Thought Prompting...", remark: "", location: "201", time: "9:30-11:30", T1_done: true, T2_1_done: true, T2_2_done: true, T3_done: false, isHoliday: false},
        {week: 2, date: "2025-12-05", T1: "Áè≠Êñ∞Âçö", T2_1: "Èæö‰∏Ω", T2_2: "Âè∂ÁéÆ‰Ω≥", T3: "Êùé‰Ω≥Êôü", topic: "iFlow CLI / MinerU2.5... / Agentic AI", remark: "", location: "201", time: "9:30-11:30", T1_done: true, T2_1_done: true, T2_2_done: true, T3_done: true, isHoliday: false},
        {week: 3, date: "2025-12-12", T1: "Ëß£ÂãáÂÆù", T2_1: "Âè∂ÁéÆ‰Ω≥", T2_2: "Èæö‰∏Ω", T3: "", topic: "SAM 3: Segment Anything with Concepts...", remark: "", location: "201", time: "9:30-11:30", T1_done: true, T2_1_done: true, T2_2_done: true, T3_done: false, isHoliday: false},
        {week: 4, date: "2025-12-19", T1: "Èæö‰∏Ω", T2_1: "Êùé‰Ω≥Êôü", T2_2: "Áè≠Êñ∞Âçö", T3: "Ëß£ÂãáÂÆù", topic: "", remark: "", location: "201", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 5, date: "2025-12-26", T1: "Âè∂ÁéÆ‰Ω≥", T2_1: "Áè≠Êñ∞Âçö", T2_2: "Êùé‰Ω≥Êôü", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},

        // ===== 2026Âπ¥Á¨¨‰∏ÄÂ≠£Â∫¶ =====
        {week: 6, date: "2026-01-02", T1: "Êùé‰Ω≥Êôü", T2_1: "Ëß£ÂãáÂÆù", T2_2: "Èæö‰∏Ω", T3: "Âè∂ÁéÆ‰Ω≥", topic: "", remark: "ÂÅáÊúüÂÜ≤Á™ÅÔºàÂÖÉÊó¶1Êúà1-3Êó•ÔºâÔºåÊó∂Èó¥ËßÜÂÖ∑‰ΩìÊÉÖÂÜµÂÆö", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 7, date: "2026-01-09", T1: "Áè≠Êñ∞Âçö", T2_1: "Èæö‰∏Ω", T2_2: "Ëß£ÂãáÂÆù", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 8, date: "2026-01-16", T1: "Ëß£ÂãáÂÆù", T2_1: "Âè∂ÁéÆ‰Ω≥", T2_2: "Êùé‰Ω≥Êôü", T3: "Áè≠Êñ∞Âçö", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 9, date: "2026-01-23", T1: "Èæö‰∏Ω", T2_1: "Êùé‰Ω≥Êôü", T2_2: "Âè∂ÁéÆ‰Ω≥", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 10, date: "2026-01-30", T1: "Âè∂ÁéÆ‰Ω≥", T2_1: "Áè≠Êñ∞Âçö", T2_2: "Ëß£ÂãáÂÆù", T3: "Èæö‰∏Ω", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 11, date: "2026-02-06", T1: "Êùé‰Ω≥Êôü", T2_1: "Ëß£ÂãáÂÆù", T2_2: "Áè≠Êñ∞Âçö", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 12, date: "2026-02-13", T1: "Áè≠Êñ∞Âçö", T2_1: "Èæö‰∏Ω", T2_2: "Âè∂ÁéÆ‰Ω≥", T3: "Êùé‰Ω≥Êôü", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 13, date: "2026-02-20", T1: "Ëß£ÂãáÂÆù", T2_1: "Âè∂ÁéÆ‰Ω≥", T2_2: "Èæö‰∏Ω", T3: "", topic: "", remark: "ÂÅáÊúüÂÜ≤Á™ÅÔºàÊò•ËäÇ2Êúà15-23Êó•ÔºâÔºåÊó∂Èó¥ËßÜÂÖ∑‰ΩìÊÉÖÂÜµÂÆö", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 14, date: "2026-02-27", T1: "Èæö‰∏Ω", T2_1: "Êùé‰Ω≥Êôü", T2_2: "Áè≠Êñ∞Âçö", T3: "Ëß£ÂãáÂÆù", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 15, date: "2026-03-06", T1: "Âè∂ÁéÆ‰Ω≥", T2_1: "Áè≠Êñ∞Âçö", T2_2: "Êùé‰Ω≥Êôü", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 16, date: "2026-03-13", T1: "Êùé‰Ω≥Êôü", T2_1: "Ëß£ÂãáÂÆù", T2_2: "Èæö‰∏Ω", T3: "Âè∂ÁéÆ‰Ω≥", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 17, date: "2026-3-20", T1: "Áè≠Êñ∞Âçö", T2_1: "Èæö‰∏Ω", T2_2: "Ëß£ÂãáÂÆù", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 18, date: "2026-3-27", T1: "Ëß£ÂãáÂÆù", T2_1: "Âè∂ÁéÆ‰Ω≥", T2_2: "Êùé‰Ω≥Êôü", T3: "Áè≠Êñ∞Âçö", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},

        // ===== 2026Âπ¥Á¨¨‰∫åÂ≠£Â∫¶ =====
        {week: 19, date: "2026-04-03", T1: "Èæö‰∏Ω", T2_1: "Êùé‰Ω≥Êôü", T2_2: "Âè∂ÁéÆ‰Ω≥", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 20, date: "2026-04-10", T1: "Âè∂ÁéÆ‰Ω≥", T2_1: "Áè≠Êñ∞Âçö", T2_2: "Ëß£ÂãáÂÆù", T3: "Èæö‰∏Ω", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 21, date: "2026-04-17", T1: "Êùé‰Ω≥Êôü", T2_1: "Ëß£ÂãáÂÆù", T2_2: "Áè≠Êñ∞Âçö", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 22, date: "2026-04-24", T1: "Áè≠Êñ∞Âçö", T2_1: "Èæö‰∏Ω", T2_2: "Âè∂ÁéÆ‰Ω≥", T3: "Êùé‰Ω≥Êôü", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 23, date: "2026-05-01", T1: "Ëß£ÂãáÂÆù", T2_1: "Âè∂ÁéÆ‰Ω≥", T2_2: "Èæö‰∏Ω", T3: "", topic: "", remark: "ÂÅáÊúüÂÜ≤Á™ÅÔºàÂä≥Âä®ËäÇ5Êúà1-5Êó•ÔºâÔºåÊó∂Èó¥ËßÜÂÖ∑‰ΩìÊÉÖÂÜµÂÆö", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 24, date: "2026-05-08", T1: "Èæö‰∏Ω", T2_1: "Êùé‰Ω≥Êôü", T2_2: "Áè≠Êñ∞Âçö", T3: "Ëß£ÂãáÂÆù", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 25, date: "2026-05-15", T1: "Âè∂ÁéÆ‰Ω≥", T2_1: "Áè≠Êñ∞Âçö", T2_2: "Êùé‰Ω≥Êôü", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 26, date: "2026-05-22", T1: "Êùé‰Ω≥Êôü", T2_1: "Ëß£ÂãáÂÆù", T2_2: "Èæö‰∏Ω", T3: "Âè∂ÁéÆ‰Ω≥", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 27, date: "2026-05-29", T1: "Áè≠Êñ∞Âçö", T2_1: "Èæö‰∏Ω", T2_2: "Ëß£ÂãáÂÆù", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 28, date: "2026-06-05", T1: "Ëß£ÂãáÂÆù", T2_1: "Âè∂ÁéÆ‰Ω≥", T2_2: "Êùé‰Ω≥Êôü", T3: "Áè≠Êñ∞Âçö", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 29, date: "2026-06-21", T1: "Èæö‰∏Ω", T2_1: "Êùé‰Ω≥Êôü", T2_2: "Âè∂ÁéÆ‰Ω≥", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 30, date: "2026-06-19", T1: "Âè∂ÁéÆ‰Ω≥", T2_1: "Áè≠Êñ∞Âçö", T2_2: "Ëß£ÂãáÂÆù", T3: "Èæö‰∏Ω", topic: "", remark: "ÂÅáÊúüÂÜ≤Á™ÅÔºàÁ´ØÂçàËäÇ6Êúà19-21Êó•ÔºâÔºåÊó∂Èó¥ËßÜÂÖ∑‰ΩìÊÉÖÂÜµÂÆö", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 31, date: "2026-06-26", T1: "Êùé‰Ω≥Êôü", T2_1: "Ëß£ÂãáÂÆù", T2_2: "Áè≠Êñ∞Âçö", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},

        // ===== 2026Âπ¥Á¨¨‰∏âÂ≠£Â∫¶ =====
        {week: 32, date: "2026-07-03", T1: "Áè≠Êñ∞Âçö", T2_1: "Èæö‰∏Ω", T2_2: "Âè∂ÁéÆ‰Ω≥", T3: "Êùé‰Ω≥Êôü", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 33, date: "2026-07-10", T1: "Ëß£ÂãáÂÆù", T2_1: "Âè∂ÁéÆ‰Ω≥", T2_2: "Èæö‰∏Ω", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 34, date: "2026-07-17", T1: "Èæö‰∏Ω", T2_1: "Êùé‰Ω≥Êôü", T2_2: "Áè≠Êñ∞Âçö", T3: "Ëß£ÂãáÂÆù", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 35, date: "2026-07-24", T1: "Âè∂ÁéÆ‰Ω≥", T2_1: "Áè≠Êñ∞Âçö", T2_2: "Êùé‰Ω≥Êôü", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 36, date: "2026-07-31", T1: "Êùé‰Ω≥Êôü", T2_1: "Ëß£ÂãáÂÆù", T2_2: "Èæö‰∏Ω", T3: "Âè∂ÁéÆ‰Ω≥", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 37, date: "2026-08-07", T1: "Áè≠Êñ∞Âçö", T2_1: "Èæö‰∏Ω", T2_2: "Ëß£ÂãáÂÆù", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 38, date: "2026-08-14", T1: "Ëß£ÂãáÂÆù", T2_1: "Âè∂ÁéÆ‰Ω≥", T2_2: "Êùé‰Ω≥Êôü", T3: "Áè≠Êñ∞Âçö", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 39, date: "2026-08-21", T1: "Èæö‰∏Ω", T2_1: "Êùé‰Ω≥Êôü", T2_2: "Âè∂ÁéÆ‰Ω≥", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 40, date: "2026-08-28", T1: "Âè∂ÁéÆ‰Ω≥", T2_1: "Áè≠Êñ∞Âçö", T2_2: "Ëß£ÂãáÂÆù", T3: "Èæö‰∏Ω", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 41, date: "2026-09-04", T1: "Êùé‰Ω≥Êôü", T2_1: "Ëß£ÂãáÂÆù", T2_2: "Áè≠Êñ∞Âçö", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 42, date: "2026-09-11", T1: "Áè≠Êñ∞Âçö", T2_1: "Èæö‰∏Ω", T2_2: "Âè∂ÁéÆ‰Ω≥", T3: "Êùé‰Ω≥Êôü", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 43, date: "2026-09-18", T1: "Ëß£ÂãáÂÆù", T2_1: "Âè∂ÁéÆ‰Ω≥", T2_2: "Èæö‰∏Ω", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 44, date: "2026-09-25", T1: "Èæö‰∏Ω", T2_1: "Êùé‰Ω≥Êôü", T2_2: "Áè≠Êñ∞Âçö", T3: "Ëß£ÂãáÂÆù", topic: "", remark: "ÂÅáÊúüÂÜ≤Á™ÅÔºà‰∏≠ÁßãËäÇ9Êúà25-27Êó•ÔºâÔºåÊó∂Èó¥ËßÜÂÖ∑‰ΩìÊÉÖÂÜµÂÆö", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},

        // ===== 2026Âπ¥Á¨¨ÂõõÂ≠£Â∫¶ =====
        {week: 45, date: "2026-10-02", T1: "Âè∂ÁéÆ‰Ω≥", T2_1: "Áè≠Êñ∞Âçö", T2_2: "Êùé‰Ω≥Êôü", T3: "", topic: "", remark: "ÂÅáÊúüÂÜ≤Á™ÅÔºàÂõΩÂ∫ÜËäÇ10Êúà1-7Êó•ÔºâÔºåÊó∂Èó¥ËßÜÂÖ∑‰ΩìÊÉÖÂÜµÂÆö", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 46, date: "2026-10-09", T1: "Êùé‰Ω≥Êôü", T2_1: "Ëß£ÂãáÂÆù", T2_2: "Èæö‰∏Ω", T3: "Âè∂ÁéÆ‰Ω≥", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 47, date: "2026-10-16", T1: "Áè≠Êñ∞Âçö", T2_1: "Èæö‰∏Ω", T2_2: "Ëß£ÂãáÂÆù", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 48, date: "2026-10-23", T1: "Ëß£ÂãáÂÆù", T2_1: "Âè∂ÁéÆ‰Ω≥", T2_2: "Êùé‰Ω≥Êôü", T3: "Áè≠Êñ∞Âçö", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 49, date: "2026-10-30", T1: "Èæö‰∏Ω", T2_1: "Êùé‰Ω≥Êôü", T2_2: "Âè∂ÁéÆ‰Ω≥", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 50, date: "2026-11-06", T1: "Âè∂ÁéÆ‰Ω≥", T2_1: "Áè≠Êñ∞Âçö", T2_2: "Ëß£ÂãáÂÆù", T3: "Èæö‰∏Ω", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 51, date: "2026-11-13", T1: "Êùé‰Ω≥Êôü", T2_1: "Ëß£ÂãáÂÆù", T2_2: "Áè≠Êñ∞Âçö", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 52, date: "2026-11-20", T1: "Áè≠Êñ∞Âçö", T2_1: "Èæö‰∏Ω", T2_2: "Âè∂ÁéÆ‰Ω≥", T3: "Êùé‰Ω≥Êôü", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 53, date: "2026-11-27", T1: "Ëß£ÂãáÂÆù", T2_1: "Âè∂ÁéÆ‰Ω≥", T2_2: "Èæö‰∏Ω", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 54, date: "2026-12-04", T1: "Èæö‰∏Ω", T2_1: "Êùé‰Ω≥Êôü", T2_2: "Áè≠Êñ∞Âçö", T3: "Ëß£ÂãáÂÆù", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 55, date: "2026-12-11", T1: "Âè∂ÁéÆ‰Ω≥", T2_1: "Áè≠Êñ∞Âçö", T2_2: "Êùé‰Ω≥Êôü", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 56, date: "2026-12-18", T1: "Êùé‰Ω≥Êôü", T2_1: "Ëß£ÂãáÂÆù", T2_2: "Èæö‰∏Ω", T3: "Âè∂ÁéÆ‰Ω≥", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},
        {week: 57, date: "2026-12-25", T1: "Áè≠Êñ∞Âçö", T2_1: "Èæö‰∏Ω", T2_2: "Ëß£ÂãáÂÆù", T3: "", topic: "", remark: "", location: "603", time: "9:30-11:30", T1_done: false, T2_1_done: false, T2_2_done: false, T3_done: false, isHoliday: false},

        // ÊéíÁè≠ÁªìÊùü
    ];

    // --- 2. Ê†∏ÂøÉÂäüËÉΩÔºöË°®Ê†ºÊ∏≤Êüì ---
    const scheduleBody = document.getElementById('scheduleBody');
    const statsCardsContainer = document.getElementById('statsCards');
    const members = ['Áè≠Êñ∞Âçö', 'Èæö‰∏Ω', 'Êùé‰Ω≥Êôü', 'Ëß£ÂãáÂÆù', 'Âè∂ÁéÆ‰Ω≥'];

    // Â∞ÜÊñáÊú¨‰∏≠ÁöÑURLËΩ¨Êç¢‰∏∫ÂèØÁÇπÂáªÁöÑÈìæÊé•
    function linkifyText(text) {
        if (!text) return '';

        // URLÊ≠£ÂàôË°®ËææÂºèÔºåÂåπÈÖçhttp(s)://ÂºÄÂ§¥ÁöÑÈìæÊé•
        // ÂåπÈÖçÂà∞Á©∫ÁôΩ„ÄÅÊç¢Ë°åÊàñÂ∏∏ËßÅÁöÑÁªìÂ∞æÊ†áÁÇπÁ¨¶Âè∑Ôºà‰∏çÂåÖÊã¨Ê†áÁÇπ‰Ωú‰∏∫ÈìæÊé•ÁöÑ‰∏ÄÈÉ®ÂàÜÔºâ
        const urlRegex = /(https?:\/\/[^\s<>"]+)/gi;

        // ÊõøÊç¢URL‰∏∫ÂèØÁÇπÂáªÁöÑÈìæÊé•
        return text.replace(urlRegex, (match) => {
            // ÂéªÈô§URLÊú´Â∞æÁöÑÊ†áÁÇπÁ¨¶Âè∑Ôºà‰∏≠Ëã±ÊñáÊã¨Âè∑„ÄÅÂè•Âè∑„ÄÅÈÄóÂè∑Á≠âÔºâ
            let url = match;
            const trailingPunctuation = /[)Ôºâ,.;:!?„ÄÇÔºå„ÄÅÔºõÔºöÔºÅÔºü„Äã„Äç„Äë]+$/;
            const punctMatch = url.match(trailingPunctuation);
            let trailing = '';

            if (punctMatch) {
                trailing = punctMatch[0];
                url = url.slice(0, -trailing.length);
            }

            return `<a href="${url}" target="_blank" rel="noopener noreferrer" class="inline-link" onclick="event.stopPropagation();">${url}</a>${trailing}`;
        });
    }

    // ÁªüËÆ°ÂêÑÊàêÂëòÂ∑≤ÂÆåÊàêÁöÑÂàÜ‰∫´Ê¨°Êï∞ÔºàÊ†πÊçÆÂãæÈÄâÁä∂ÊÄÅÔºâ
    function calculateStats() {
        const stats = {};
        members.forEach(name => {
            stats[name] = { T1: 0, T2: 0, T3: 0, total: 0 };
        });

        scheduleData.forEach(item => {
            // T1: AI/‰∫ßÂìÅÂàÜÊûê
            if (item.T1 && item.T1_done && stats[item.T1]) {
                stats[item.T1].T1++;
                stats[item.T1].total++;
            }
            // T2_1: ËÆ∫ÊñáÁ†îËØª
            if (item.T2_1 && item.T2_1_done && stats[item.T2_1]) {
                stats[item.T2_1].T2++;
                stats[item.T2_1].total++;
            }
            // T2_2: ËÆ∫ÊñáÁ†îËØª
            if (item.T2_2 && item.T2_2_done && stats[item.T2_2]) {
                stats[item.T2_2].T2++;
                stats[item.T2_2].total++;
            }
            // T3: ÊäÄÊúØ‰∏ªÈ¢òÂàÜ‰∫´
            if (item.T3 && item.T3_done && stats[item.T3]) {
                stats[item.T3].T3++;
                stats[item.T3].total++;
            }
        });

        return stats;
    }

    // Ê∏≤ÊüìÁªüËÆ°Âç°Áâá
    function renderStats() {
        const stats = calculateStats();

        // Â¶ÇÊûúÁªüËÆ°Âç°ÁâáÂ∑≤Â≠òÂú®ÔºåÂè™Êõ¥Êñ∞Êï∞ÂÄºÔºå‰∏çÈáçÂª∫DOM
        const existingCards = statsCardsContainer.querySelectorAll('.stat-card');

        if (existingCards.length === members.length) {
            // Âè™Êõ¥Êñ∞Êï∞ÂÄºÔºåÈÅøÂÖçÈáçÂª∫DOMÈÄ†ÊàêÈó™ÁÉÅ
            let needsRebuild = false;

            members.forEach((name, idx) => {
                const s = stats[name];
                const card = existingCards[idx];

                if (card) {
                    // Ê∑ªÂä†‰∏•Ê†ºÁöÑnullÊ£ÄÊü•
                    const t1Value = card.querySelector('.stat-row:nth-of-type(1) .value');
                    const t2Value = card.querySelector('.stat-row:nth-of-type(2) .value');
                    const t3Value = card.querySelector('.stat-row:nth-of-type(3) .value');
                    const totalValue = card.querySelector('.total-row .value');

                    if (t1Value && t2Value && t3Value && totalValue) {
                        t1Value.textContent = s.T1;
                        t2Value.textContent = s.T2;
                        t3Value.textContent = s.T3;
                        totalValue.textContent = s.total;
                    } else {
                        // Â¶ÇÊûúDOMÁªìÊûÑ‰∏çÂÆåÊï¥ÔºåÊ†áËÆ∞ÈúÄË¶ÅÈáçÂª∫
                        needsRebuild = true;
                    }
                } else {
                    needsRebuild = true;
                }
            });

            // Â¶ÇÊûúÊ£ÄÊµãÂà∞DOMÈóÆÈ¢òÔºåÈáçÂª∫ÁªüËÆ°Âç°Áâá
            if (needsRebuild) {
                rebuildStatsCards(stats);
            }
        } else {
            // È¶ñÊ¨°Ê∏≤ÊüìÊàñÊàêÂëòÊï∞ÈáèÂèòÂåñÊó∂ÔºåÈáçÂª∫DOM
            rebuildStatsCards(stats);
        }
    }

    // ÈáçÂª∫ÁªüËÆ°Âç°ÁâáDOM
    function rebuildStatsCards(stats) {
        statsCardsContainer.innerHTML = '';

        members.forEach(name => {
            const s = stats[name];
            const card = document.createElement('div');
            card.className = `stat-card p-${name}`;
            card.innerHTML = `
                <div class="name">${name}</div>
                <div class="stat-row">
                    <span class="label">AI/‰∫ßÂìÅÂ∑•ÂÖ∑</span>
                    <span class="value">${s.T1}</span>
                </div>
                <div class="stat-row">
                    <span class="label">ËÆ∫Êñá/ÂºÄÊ∫êÈ°πÁõÆ</span>
                    <span class="value">${s.T2}</span>
                </div>
                <div class="stat-row">
                    <span class="label">ÊäÄÊúØ‰∏ªÈ¢òÂàÜ‰∫´</span>
                    <span class="value">${s.T3}</span>
                </div>
                <div class="total-row">
                    <span class="label">ÊÄªËÆ°</span>
                    <span class="value">${s.total}</span>
                </div>
            `;
            statsCardsContainer.appendChild(card);
        });
    }

    function renderSchedule() {
        scheduleBody.innerHTML = ''; // Ê∏ÖÁ©∫Áé∞ÊúâÂÜÖÂÆπ
        const today = new Date().toISOString().split('T')[0];

        // ÊâæÂà∞ÊúÄËøëÊàñÂΩìÂâçÊú™ÂÆåÊàêÁöÑ‰ªªÂä°ÁöÑË°åÁ¥¢ÂºïÔºàËá≥Â∞ëÊúâ‰∏Ä‰∏™‰ªªÂä°Êú™ÂÆåÊàêÔºâ
        const firstPendingIndex = scheduleData.findIndex(d =>
            !d.isHoliday && (
                (d.T1 && !d.T1_done) ||
                (d.T2_1 && !d.T2_1_done) ||
                (d.T2_2 && !d.T2_2_done) ||
                (d.T3 && !d.T3_done)
            )
        );

        scheduleData.forEach((item, index) => {
            const row = scheduleBody.insertRow();
            let rowClass = '';

            // Ê£ÄÊü•ÊòØÂê¶ÊâÄÊúâ‰ªªÂä°ÈÉΩÂ∑≤ÂÆåÊàê
            const allDone = !item.isHoliday && (
                (!item.T1 || item.T1_done) &&
                (!item.T2_1 || item.T2_1_done) &&
                (!item.T2_2 || item.T2_2_done) &&
                (!item.T3 || item.T3_done)
            ) && (item.T1 || item.T2_1 || item.T2_2 || item.T3); // Ëá≥Â∞ëÊúâ‰∏Ä‰∏™‰ªªÂä°

            // Ê£ÄÊü•Áä∂ÊÄÅ‰ª•Ê∑ªÂä†ÂèØËßÜÂåñÁ±ª
            if (item.isHoliday) {
                rowClass = 'status-holiday';
            } else if (allDone) {
                rowClass = 'status-done';
            } else if (index === firstPendingIndex) {
                // Ê†áËÆ∞ÊúÄËøëË¶ÅËøõË°åÁöÑ‰ªªÂä°
                rowClass = 'status-current';
            }
            row.className = rowClass;

            // Â°´ÂÖÖÊï∞ÊçÆË°å
            row.insertCell().textContent = item.week; // Âë®Êï∞
            row.insertCell().textContent = item.date; // Êó•Êúü

            // ‰ºöËÆÆÂú∞ÁÇπ (ÂèØÁºñËæë)
            const locationCell = row.insertCell();
            locationCell.className = 'editable location-field';
            if (!item.isHoliday) {
                const room = item.location || '201';
                const time = item.time || '9:30-11:30';
                locationCell.innerHTML = `<div class="room">${room}</div><div class="time">${time}</div>`;
            }
            locationCell.setAttribute('data-index', index);
            locationCell.setAttribute('data-field', 'location');

            // ÂèØÁºñËæëÂçïÂÖÉÊ†º (‰∏ªÈ¢ò & ÈìæÊé•)
            const topicCell = row.insertCell();
            topicCell.className = 'editable topic-link';
            // ÂÖàÊõøÊç¢Êç¢Ë°åÁ¨¶ÔºåÁÑ∂ÂêéÂ∞ÜURLËΩ¨Êç¢‰∏∫ÂèØÁÇπÂáªÁöÑÈìæÊé•
            const topicWithBreaks = item.topic ? item.topic.replace(/\n/g, '<br>') : '';
            topicCell.innerHTML = linkifyText(topicWithBreaks);
            topicCell.setAttribute('data-index', index); // Áî®‰∫éÊï∞ÊçÆÁªëÂÆö
            topicCell.setAttribute('data-field', 'topic');

            // Êñá‰ª∂‰∏ä‰º†/‰∏ãËΩΩÂçïÂÖÉÊ†º
            const filesCell = row.insertCell();
            filesCell.className = 'files-cell';
            filesCell.setAttribute('data-index', index);
            if (!item.files) item.files = []; // ÂàùÂßãÂåñfilesÊï∞ÁªÑ
            filesCell.innerHTML = renderFilesCell(item.files, index);

            // Â§áÊ≥®ÂçïÂÖÉÊ†º
            const remarkCell = row.insertCell();
            remarkCell.className = 'editable remark-field';
            remarkCell.innerHTML = item.remark ? item.remark.replace(/\n/g, '<br>') : '';
            remarkCell.setAttribute('data-index', index);
            remarkCell.setAttribute('data-field', 'remark');

            // ÂÆåÊàêÁä∂ÊÄÅÂãæÈÄâÊ°ÜÂçïÂÖÉÊ†º
            const statusCell = row.insertCell();
            statusCell.innerHTML = createCheckboxes(item, index);
        });

        addEditableListeners();
        addCheckboxListeners();
        // addFileListeners() Áé∞Âú®Âè™Âú®ÂàùÂßãÂåñÊó∂Ë∞ÉÁî®‰∏ÄÊ¨°Ôºå‰ΩøÁî®‰∫ã‰ª∂ÂßîÊâò
        renderStats(); // Êõ¥Êñ∞ÁªüËÆ°
    }

    // --- Êñá‰ª∂‰∏ä‰º†/‰∏ãËΩΩÂäüËÉΩ ---

    // Ê∏≤ÊüìÊñá‰ª∂ÂçïÂÖÉÊ†º
    function renderFilesCell(files, index, uploadingFiles = []) {
        let html = '<div class="files-container">';

        // ÊòæÁ§∫Â∑≤‰∏ä‰º†ÁöÑÊñá‰ª∂ÂàóË°®
        if (files && files.length > 0) {
            html += '<div class="files-list">';
            files.forEach((file, fileIndex) => {
                const fileName = file.name || file.filename || `Êñá‰ª∂${fileIndex + 1}`;
                const fileSize = file.size ? formatFileSize(file.size) : '';
                html += `
                    <div class="file-item">
                        <a href="#" class="file-preview" data-index="${index}" data-file-index="${fileIndex}" title="${fileName}">
                            üìé ${truncateFileName(fileName, 20)}
                        </a>
                        <span class="file-size">${fileSize}</span>
                        <button class="file-delete" data-index="${index}" data-file-index="${fileIndex}" title="Âà†Èô§Êñá‰ª∂">√ó</button>
                    </div>
                `;
            });
            html += '</div>';
        }

        // ÊòæÁ§∫Ê≠£Âú®‰∏ä‰º†ÁöÑÊñá‰ª∂
        if (uploadingFiles && uploadingFiles.length > 0) {
            if (!files || files.length === 0) {
                html += '<div class="files-list">';
            }
            uploadingFiles.forEach((uploadingFile, idx) => {
                const fileName = uploadingFile.name;
                const progress = uploadingFile.progress || 0;
                html += `
                    <div class="file-item uploading" id="uploading-file-${index}-${idx}">
                        <div style="flex: 1; min-width: 0;">
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <span style="color: var(--accent-primary);">üì§</span>
                                <span class="file-download" style="flex: 1; min-width: 0; pointer-events: none;">${truncateFileName(fileName, 20)}</span>
                            </div>
                            <div class="file-progress-container">
                                <div class="file-progress-bar">
                                    <div class="file-progress-fill" style="width: ${progress}%"></div>
                                </div>
                                <div class="file-progress-text">${progress}%</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            if (!files || files.length === 0) {
                html += '</div>';
            }
        }

        // ‰∏ä‰º†ÊåâÈíÆ
        html += `
            <div class="file-upload-wrapper">
                <input type="file" id="file-input-${index}" class="file-input" data-index="${index}" multiple style="display: none;">
                <button class="file-upload-btn" data-index="${index}" title="‰∏ä‰º†Êñá‰ª∂">
                    üì§ ‰∏ä‰º†
                </button>
            </div>
        `;

        html += '</div>';
        return html;
    }

    // Ê†ºÂºèÂåñÊñá‰ª∂Â§ßÂ∞è
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 B';
        const k = 1024;
        const sizes = ['B', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];
    }

    // Êà™Êñ≠Êñá‰ª∂Âêç
    function truncateFileName(fileName, maxLength) {
        if (fileName.length <= maxLength) return fileName;
        const extension = fileName.split('.').pop();
        const nameWithoutExt = fileName.substring(0, fileName.lastIndexOf('.'));
        const truncatedName = nameWithoutExt.substring(0, maxLength - extension.length - 4) + '...';
        return truncatedName + '.' + extension;
    }

    // ÁªëÂÆöÊñá‰ª∂Áõ∏ÂÖ≥‰∫ã‰ª∂ÁõëÂê¨Âô®Ôºà‰ΩøÁî®‰∫ã‰ª∂ÂßîÊâòÈÅøÂÖçÈáçÂ§çÁªëÂÆöÔºâ
    function addFileListeners() {
        // ‰ΩøÁî®‰∏Ä‰∏™Ê†áÂøóÊù•Á°Æ‰øù‰∫ã‰ª∂ÁõëÂê¨Âô®Âè™Ë¢´Ê∑ªÂä†‰∏ÄÊ¨°
        if (window.fileListenersAdded) {
            return;
        }

        // ‰∏∫Êï¥‰∏™ÊñáÊ°£Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®Ôºà‰∫ã‰ª∂ÂßîÊâòÔºâ
        document.addEventListener('click', (e) => {
            // Â§ÑÁêÜ‰∏ä‰º†ÊåâÈíÆÁÇπÂáª
            if (e.target.classList.contains('file-upload-btn') || e.target.closest('.file-upload-btn')) {
                e.preventDefault();
                const btn = e.target.classList.contains('file-upload-btn') ? e.target : e.target.closest('.file-upload-btn');
                const index = btn.getAttribute('data-index');
                const fileInput = document.getElementById(`file-input-${index}`);
                if (fileInput) {
                    fileInput.click();
                }
            }

            // Â§ÑÁêÜÂà†Èô§ÊåâÈíÆÁÇπÂáª
            if (e.target.classList.contains('file-delete')) {
                e.preventDefault();
                const index = parseInt(e.target.getAttribute('data-index'));
                const fileIndex = parseInt(e.target.getAttribute('data-file-index'));

                if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Êñá‰ª∂ÂêóÔºü')) {
                    handleFileDelete(index, fileIndex);
                }
            }

            // Â§ÑÁêÜÈ¢ÑËßàÊåâÈíÆÁÇπÂáª
            if (e.target.classList.contains('file-preview') || e.target.closest('.file-preview')) {
                e.preventDefault();
                const link = e.target.classList.contains('file-preview') ? e.target : e.target.closest('.file-preview');
                const index = parseInt(link.getAttribute('data-index'));
                const fileIndex = parseInt(link.getAttribute('data-file-index'));
                openFilePreview(index, fileIndex).catch(error => {
                    console.error('È¢ÑËßàÈîôËØØ:', error);
                });
            }
        });

        // Êñá‰ª∂ÈÄâÊã©‰∫ã‰ª∂
        document.addEventListener('change', async (e) => {
            if (e.target.classList.contains('file-input')) {
                const index = parseInt(e.target.getAttribute('data-index'));
                const files = Array.from(e.target.files);

                if (files.length > 0) {
                    await handleFileUpload(index, files);
                    e.target.value = ''; // Ê∏ÖÁ©∫inputÔºåÂÖÅËÆ∏ÈáçÂ§ç‰∏ä‰º†Âêå‰∏ÄÊñá‰ª∂
                }
            }
        });

        // Ê†áËÆ∞‰∫ã‰ª∂ÁõëÂê¨Âô®Â∑≤Ê∑ªÂä†
        window.fileListenersAdded = true;
    }

    // Â§ÑÁêÜÊñá‰ª∂‰∏ä‰º†
    async function handleFileUpload(index, files) {
        const item = scheduleData[index];
        if (!item.files) item.files = [];

        // ÂáÜÂ§á‰∏ä‰º†Êñá‰ª∂‰ø°ÊÅØÔºàÁî®‰∫éÊòæÁ§∫ËøõÂ∫¶Ôºâ
        const uploadingFiles = Array.from(files).map(file => ({
            name: file.name,
            progress: 0
        }));

        try {
            // Ëé∑ÂèñÊñá‰ª∂ÂçïÂÖÉÊ†ºÂπ∂Ê∏≤Êüì‰∏ä‰º†‰∏≠ÁöÑÊñá‰ª∂
            const filesCell = document.querySelector(`.files-cell[data-index="${index}"]`);
            if (filesCell) {
                filesCell.innerHTML = renderFilesCell(item.files, index, uploadingFiles);
            }

            const formData = new FormData();
            files.forEach(file => {
                formData.append('files', file);
            });
            formData.append('scheduleId', item.id || index);

            // ‰ΩøÁî® XMLHttpRequest ‰ª•ÊîØÊåÅËøõÂ∫¶ÁõëÂê¨
            const result = await new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();

                // ÁõëÂê¨‰∏ä‰º†ËøõÂ∫¶
                xhr.upload.addEventListener('progress', (e) => {
                    if (e.lengthComputable) {
                        const percentComplete = Math.round((e.loaded / e.total) * 100);

                        // Êõ¥Êñ∞ÊâÄÊúâÊñá‰ª∂ÁöÑËøõÂ∫¶ÔºàÁÆÄÂåñÂ§ÑÁêÜÔºåÊâÄÊúâÊñá‰ª∂ÊòæÁ§∫Áõ∏ÂêåËøõÂ∫¶Ôºâ
                        uploadingFiles.forEach((file, idx) => {
                            file.progress = percentComplete;

                            // ÂÆûÊó∂Êõ¥Êñ∞ËøõÂ∫¶Êù°
                            const progressFill = document.querySelector(`#uploading-file-${index}-${idx} .file-progress-fill`);
                            const progressText = document.querySelector(`#uploading-file-${index}-${idx} .file-progress-text`);

                            if (progressFill) {
                                progressFill.style.width = `${percentComplete}%`;
                            }
                            if (progressText) {
                                progressText.textContent = `${percentComplete}%`;
                            }
                        });
                    }
                });

                // ‰∏ä‰º†ÂÆåÊàê
                xhr.addEventListener('load', () => {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        try {
                            const response = JSON.parse(xhr.responseText);
                            resolve(response);
                        } catch (e) {
                            reject(new Error('Ëß£ÊûêÂìçÂ∫îÂ§±Ë¥•'));
                        }
                    } else {
                        reject(new Error(`‰∏ä‰º†Â§±Ë¥•: ${xhr.status}`));
                    }
                });

                // ‰∏ä‰º†Âá∫Èîô
                xhr.addEventListener('error', () => {
                    reject(new Error('ÁΩëÁªúÈîôËØØ'));
                });

                // ‰∏ä‰º†‰∏≠Ê≠¢
                xhr.addEventListener('abort', () => {
                    reject(new Error('‰∏ä‰º†Â∑≤ÂèñÊ∂à'));
                });

                // ÂèëÈÄÅËØ∑Ê±Ç
                xhr.open('POST', `${API_BASE_URL}/schedule/${item.id || index}/files`);
                xhr.send(formData);
            });

            // Êõ¥Êñ∞Êú¨Âú∞Êï∞ÊçÆ
            if (result.files) {
                item.files = result.files;
            } else {
                // Â¶ÇÊûúÂêéÁ´Ø‰∏çËøîÂõûÂÆåÊï¥Êñá‰ª∂ÂàóË°®ÔºåÊâãÂä®Ê∑ªÂä†
                files.forEach(file => {
                    item.files.push({
                        name: file.name,
                        size: file.size,
                        uploadDate: new Date().toISOString()
                    });
                });
            }

            scheduleData[index] = item;
            await updateScheduleItem(index);

            // ÈáçÊñ∞Ê∏≤ÊüìÊñá‰ª∂ÂàóË°®ÔºàÁßªÈô§‰∏ä‰º†‰∏≠ÁöÑÊñá‰ª∂ÔºåÊòæÁ§∫Â∑≤‰∏ä‰º†ÁöÑÊñá‰ª∂Ôºâ
            if (filesCell) {
                filesCell.innerHTML = renderFilesCell(item.files, index);
            }

            showSuccess(`ÊàêÂäü‰∏ä‰º† ${files.length} ‰∏™Êñá‰ª∂`);
        } catch (error) {
            console.error('Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•:', error);
            showError(`Êñá‰ª∂‰∏ä‰º†Â§±Ë¥•: ${error.message}`);

            // ‰∏ä‰º†Â§±Ë¥•ÔºåÈáçÊñ∞Ê∏≤ÊüìÔºàÁßªÈô§‰∏ä‰º†‰∏≠ÁöÑÊñá‰ª∂Ôºâ
            const filesCell = document.querySelector(`.files-cell[data-index="${index}"]`);
            if (filesCell) {
                filesCell.innerHTML = renderFilesCell(item.files, index);
            }
        }
    }

    // Â§ÑÁêÜÊñá‰ª∂‰∏ãËΩΩ
    async function handleFileDownload(index, fileIndex) {
        const item = scheduleData[index];
        const file = item.files[fileIndex];

        try {
            const response = await fetch(`${API_BASE_URL}/schedule/${item.id || index}/files/${fileIndex}`);

            if (!response.ok) {
                throw new Error(`‰∏ãËΩΩÂ§±Ë¥•: ${response.status}`);
            }

            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = file.name || `file_${fileIndex}`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);

            showSuccess('Êñá‰ª∂‰∏ãËΩΩÊàêÂäü');
        } catch (error) {
            console.error('Êñá‰ª∂‰∏ãËΩΩÂ§±Ë¥•:', error);
            showError(`Êñá‰ª∂‰∏ãËΩΩÂ§±Ë¥•: ${error.message}`);
        }
    }

    // Â§ÑÁêÜÊñá‰ª∂Âà†Èô§
    async function handleFileDelete(index, fileIndex) {
        const item = scheduleData[index];

        try {
            showLoading(true);

            const response = await fetch(`${API_BASE_URL}/schedule/${item.id || index}/files/${fileIndex}`, {
                method: 'DELETE'
            });

            if (!response.ok) {
                throw new Error(`Âà†Èô§Â§±Ë¥•: ${response.status}`);
            }

            // ‰ªéÊú¨Âú∞Êï∞ÊçÆ‰∏≠Âà†Èô§
            item.files.splice(fileIndex, 1);
            scheduleData[index] = item;
            await updateScheduleItem(index);
            renderSchedule();
            showSuccess('Êñá‰ª∂Âà†Èô§ÊàêÂäü');
        } catch (error) {
            console.error('Êñá‰ª∂Âà†Èô§Â§±Ë¥•:', error);
            showError(`Êñá‰ª∂Âà†Èô§Â§±Ë¥•: ${error.message}`);
        } finally {
            showLoading(false);
        }
    }

    // ÂàõÂª∫ÂãæÈÄâÊ°ÜHTML
    function createCheckboxes(item, index) {
        let html = '<div class="status-checkboxes">';

        if (item.T1) {
            html += `
                <div class="status-checkbox-item ${item.T1_done ? 'checked' : ''}">
                    <input type="checkbox" id="cb_${index}_T1" data-index="${index}" data-field="T1_done" ${item.T1_done ? 'checked' : ''}>
                    <label for="cb_${index}_T1">${item.T1}<span class="task-type">(AIÂ∑•ÂÖ∑)</span></label>
                </div>`;
        }
        if (item.T2_1) {
            html += `
                <div class="status-checkbox-item ${item.T2_1_done ? 'checked' : ''}">
                    <input type="checkbox" id="cb_${index}_T2_1" data-index="${index}" data-field="T2_1_done" ${item.T2_1_done ? 'checked' : ''}>
                    <label for="cb_${index}_T2_1">${item.T2_1}<span class="task-type">(ËÆ∫Êñá/ÂºÄÊ∫êÈ°πÁõÆ)</span></label>
                </div>`;
        }
        if (item.T2_2) {
            html += `
                <div class="status-checkbox-item ${item.T2_2_done ? 'checked' : ''}">
                    <input type="checkbox" id="cb_${index}_T2_2" data-index="${index}" data-field="T2_2_done" ${item.T2_2_done ? 'checked' : ''}>
                    <label for="cb_${index}_T2_2">${item.T2_2}<span class="task-type">(ËÆ∫Êñá/ÂºÄÊ∫êÈ°πÁõÆ)</span></label>
                </div>`;
        }
        if (item.T3) {
            html += `
                <div class="status-checkbox-item ${item.T3_done ? 'checked' : ''}">
                    <input type="checkbox" id="cb_${index}_T3" data-index="${index}" data-field="T3_done" ${item.T3_done ? 'checked' : ''}>
                    <label for="cb_${index}_T3">${item.T3}<span class="task-type">(ÊäÄÊúØ)</span></label>
                </div>`;
        }

        html += '</div>';
        return html;
    }

    // ÁªëÂÆöÂãæÈÄâÊ°Ü‰∫ã‰ª∂
    function addCheckboxListeners() {
        document.querySelectorAll('.status-checkboxes input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', async (e) => {
                const index = parseInt(e.target.getAttribute('data-index'));
                const field = e.target.getAttribute('data-field');
                scheduleData[index][field] = e.target.checked;

                // Êõ¥Êñ∞ÂãæÈÄâÊ°ÜÊ†∑Âºè
                const item = e.target.closest('.status-checkbox-item');
                if (e.target.checked) {
                    item.classList.add('checked');
                } else {
                    item.classList.remove('checked');
                }

                // ‰øùÂ≠òÂà∞API
                await updateScheduleItem(index);
                renderStats(); // Êõ¥Êñ∞ÁªüËÆ°

                // Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅÊõ¥Êñ∞Ë°åÊ†∑Âºè
                updateRowStyle(index);
            });
        });
    }

    // Êõ¥Êñ∞Ë°åÊ†∑ÂºèÔºàÊ†πÊçÆÂÆåÊàêÁä∂ÊÄÅÔºâ
    function updateRowStyle(index) {
        const item = scheduleData[index];
        const row = scheduleBody.rows[index];

        if (item.isHoliday) return;

        const allDone = (
            (!item.T1 || item.T1_done) &&
            (!item.T2_1 || item.T2_1_done) &&
            (!item.T2_2 || item.T2_2_done) &&
            (!item.T3 || item.T3_done)
        ) && (item.T1 || item.T2_1 || item.T2_2 || item.T3);

        row.classList.remove('status-done', 'status-current');
        if (allDone) {
            row.classList.add('status-done');
        }

        // ÈáçÊñ∞ËÆ°ÁÆóÁ¨¨‰∏Ä‰∏™ÂæÖÂÆåÊàêÁöÑË°å
        const firstPendingIndex = scheduleData.findIndex(d =>
            !d.isHoliday && (
                (d.T1 && !d.T1_done) ||
                (d.T2_1 && !d.T2_1_done) ||
                (d.T2_2 && !d.T2_2_done) ||
                (d.T3 && !d.T3_done)
            )
        );

        // Êõ¥Êñ∞ÊâÄÊúâË°åÁöÑcurrentÁä∂ÊÄÅ
        Array.from(scheduleBody.rows).forEach((r, i) => {
            r.classList.remove('status-current');
            if (i === firstPendingIndex && !scheduleData[i].isHoliday) {
                const itemAtIndex = scheduleData[i];
                const isAllDone = (
                    (!itemAtIndex.T1 || itemAtIndex.T1_done) &&
                    (!itemAtIndex.T2_1 || itemAtIndex.T2_1_done) &&
                    (!itemAtIndex.T2_2 || itemAtIndex.T2_2_done) &&
                    (!itemAtIndex.T3 || itemAtIndex.T3_done)
                );
                if (!isAllDone) {
                    r.classList.add('status-current');
                }
            }
        });
    }

    // --- 3. ‰∫§‰∫íÂäüËÉΩÔºöÂÆûÁé∞ÂèØÁºñËæëÊÄß‰∏éÊï∞ÊçÆ‰øùÂ≠ò ---

    // ÁªëÂÆöÂèåÂáªÁºñËæë‰∫ã‰ª∂
    function addEditableListeners() {
        document.querySelectorAll('.editable').forEach(cell => {
            // ÁßªÈô§ÊóßÁõëÂê¨Âô®‰ª•Èò≤Ê≠¢ÈáçÂ§çÁªëÂÆö
            cell.removeEventListener('dblclick', handleDoubleClick);
            cell.addEventListener('dblclick', handleDoubleClick);
        });
    }

    // ÂèåÂáªÂ§ÑÁêÜÂáΩÊï∞
    function handleDoubleClick(e) {
        const cell = e.currentTarget;
        const index = cell.getAttribute('data-index');
        const field = cell.getAttribute('data-field');

        if (cell.querySelector('input') || cell.querySelector('textarea')) return; // ÈÅøÂÖçÈáçÂ§çÁºñËæë

        // ÁâπÊÆäÂ§ÑÁêÜÂú∞ÁÇπ/Êó∂Èó¥Â≠óÊÆµ
        if (field === 'location') {
            const item = scheduleData[index];
            const currentLocation = item.location || '201';
            const currentTime = item.time || '9:30-11:30';

            cell.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <input type="text" class="editing-location" value="${currentLocation}" placeholder="‰ºöËÆÆÂÆ§" style="width: 100%; padding: 8px; border: 2px solid var(--accent-primary); border-radius: 6px; font-family: var(--font-mono); font-size: 0.95rem; background: var(--bg-elevated); color: var(--text-primary);">
                    <input type="text" class="editing-time" value="${currentTime}" placeholder="Êó∂Èó¥" style="width: 100%; padding: 8px; border: 2px solid var(--accent-primary); border-radius: 6px; font-family: var(--font-mono); font-size: 0.85rem; background: var(--bg-elevated); color: var(--text-primary);">
                </div>
            `;
            cell.classList.add('editing');

            const locationInput = cell.querySelector('.editing-location');
            const timeInput = cell.querySelector('.editing-time');
            locationInput.focus();
            locationInput.select();

            // ‰øùÂ≠òÂáΩÊï∞
            const saveLocation = async () => {
                const newLocation = locationInput.value.trim() || '603';
                const newTime = timeInput.value.trim() || '9:30-11:30';
                scheduleData[index].location = newLocation;
                scheduleData[index].time = newTime;
                cell.innerHTML = `<div class="room">${newLocation}</div><div class="time">${newTime}</div>`;
                cell.classList.remove('editing');

                // ‰øùÂ≠òÂà∞API
                await updateScheduleItem(index);
            };

            // Â§±ÂéªÁÑ¶ÁÇπÊó∂‰øùÂ≠ò
            locationInput.addEventListener('blur', (e) => {
                // Â¶ÇÊûúÁÑ¶ÁÇπÁßªÂà∞timeËæìÂÖ•Ê°ÜÔºå‰∏ç‰øùÂ≠ò
                if (e.relatedTarget !== timeInput) {
                    setTimeout(saveLocation, 100);
                }
            });

            timeInput.addEventListener('blur', (e) => {
                // Â¶ÇÊûúÁÑ¶ÁÇπÁßªÂà∞locationËæìÂÖ•Ê°ÜÔºå‰∏ç‰øùÂ≠ò
                if (e.relatedTarget !== locationInput) {
                    setTimeout(saveLocation, 100);
                }
            });

            // EnterÈîÆ‰øùÂ≠ò
            locationInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    timeInput.focus();
                    timeInput.select();
                }
            });

            timeInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    saveLocation();
                }
            });

            return;
        }

        // ÂØπ‰∫é 'topic' Âíå 'remark' Â≠óÊÆµÔºå‰ΩøÁî®Â§öË°åÊñáÊú¨Ê°Ü
        // Â∞Ü <br> ËΩ¨Êç¢ÂõûÊç¢Ë°åÁ¨¶‰ª•‰æøÁºñËæë
        const editText = cell.innerHTML.replace(/<br\s*\/?>/gi, '\n').replace(/<[^>]*>/g, '').trim();
        cell.innerHTML = `<textarea class="editing" rows="4" placeholder="Option/Shift+EnterÊç¢Ë°åÔºåEnter‰øùÂ≠ò">${editText}</textarea>`;
        cell.classList.add('editing');

        const textarea = cell.querySelector('textarea');
        textarea.focus();
        // ÂÖâÊ†áÁßªÂà∞Êú´Â∞æ
        textarea.setSelectionRange(textarea.value.length, textarea.value.length);

        // Â§±ÂéªÁÑ¶ÁÇπÊó∂‰øùÂ≠òÊï∞ÊçÆ
        textarea.addEventListener('blur', async () => {
            const newText = textarea.value.trim();
            scheduleData[index][field] = newText;

            // Â¶ÇÊûúÊòØ topic Â≠óÊÆµÔºåÂ∞ÜURLËΩ¨Êç¢‰∏∫ÂèØÁÇπÂáªÁöÑÈìæÊé•
            if (field === 'topic') {
                const textWithBreaks = newText ? newText.replace(/\n/g, '<br>') : '';
                cell.innerHTML = linkifyText(textWithBreaks);
            } else {
                cell.innerHTML = newText ? newText.replace(/\n/g, '<br>') : '';
            }

            cell.classList.remove('editing');

            // ‰øùÂ≠òÂà∞API
            await updateScheduleItem(index);
            renderSchedule();
        });

        // Enter ‰øùÂ≠òÔºåShift+Enter Êàñ Option+Enter Êç¢Ë°å
        textarea.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                if (event.shiftKey || event.altKey || event.metaKey) {
                    // Shift+Enter / Option+Enter / Cmd+Enter ÊâãÂä®ÊèíÂÖ•Êç¢Ë°å
                    event.preventDefault();
                    const start = textarea.selectionStart;
                    const end = textarea.selectionEnd;
                    const value = textarea.value;
                    textarea.value = value.substring(0, start) + '\n' + value.substring(end);
                    textarea.selectionStart = textarea.selectionEnd = start + 1;
                } else {
                    // ÊôÆÈÄö Enter ‰øùÂ≠ò
                    event.preventDefault();
                    textarea.blur();
                }
            }
        });
    }

    // --- 4. API Êï∞ÊçÆÊåÅ‰πÖÂåñ ---

    // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
    function showLoading(show) {
        const container = document.querySelector('.container');
        if (show) {
            if (!document.getElementById('loading-overlay')) {
                const overlay = document.createElement('div');
                overlay.id = 'loading-overlay';
                overlay.className = 'loading-overlay';
                overlay.innerHTML = `
                    <div style="text-align:center;">
                        <div class="loading-spinner"></div>
                        <div style="margin-top:20px;color:var(--accent-primary);font-weight:700;font-size:1.1rem;font-family:var(--font-body);">Âä†ËΩΩ‰∏≠...</div>
                    </div>
                `;
                document.body.appendChild(overlay);
            }
        } else {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) overlay.remove();
        }
    }

    // ÊòæÁ§∫ÈîôËØØÊèêÁ§∫
    function showError(message) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'notification error';
        errorDiv.innerHTML = `<strong>‚ùå ÈîôËØØ:</strong> ${message}`;
        document.body.appendChild(errorDiv);
        setTimeout(() => errorDiv.remove(), 5000);
    }

    // ÊòæÁ§∫ÊàêÂäüÊèêÁ§∫
    function showSuccess(message) {
        const successDiv = document.createElement('div');
        successDiv.className = 'notification success';
        successDiv.innerHTML = `<strong>‚úì</strong> ${message}`;
        document.body.appendChild(successDiv);
        setTimeout(() => successDiv.remove(), 3000);
    }

    // ‰ªé API Âä†ËΩΩÊï∞ÊçÆ
    async function loadDataFromAPI(silent = false) {
        try {
            if (!silent) showLoading(true);
            const response = await fetch(`${API_BASE_URL}/schedule`);

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            if (data && data.length > 0) {
                // ÊØîËæÉÊï∞ÊçÆÊòØÂê¶ÊúâÂèòÂåñÔºàÈùôÈªòÂà∑Êñ∞Êó∂Ôºâ
                const hasChanges = !scheduleData || scheduleData.length === 0 ||
                    JSON.stringify(scheduleData) !== JSON.stringify(data);

                scheduleData = data;

                if (!silent) {
                    console.log(`‚úÖ ‰ªéÊúçÂä°Âô®Âä†ËΩΩ‰∫Ü ${data.length} Êù°ÊéíÁè≠Êï∞ÊçÆ`);
                }

                if (!silent) showLoading(false);
                return hasChanges; // ËøîÂõûÊòØÂê¶ÊúâÂèòÂåñ
            } else {
                console.warn('‚ö†Ô∏è ÊúçÂä°Âô®ËøîÂõûÁ©∫Êï∞ÊçÆÔºå‰ΩøÁî®ÈªòËÆ§ÊéíÁè≠');
                if (!silent) showLoading(false);
                return false;
            }
        } catch (error) {
            if (!silent) {
                showLoading(false);
                console.error('‚ùå Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•:', error);
                console.error('ÈîôËØØÁ±ªÂûã:', error.name);
                console.error('ÈîôËØØÊ∂àÊÅØ:', error.message);
                console.error('Ê≠£Âú®Â∞ùËØïËøûÊé•:', `${API_BASE_URL}/schedule`);
                showError(`Êó†Ê≥ïËøûÊé•Âà∞ÊúçÂä°Âô®Ôºå‰ΩøÁî®Êú¨Âú∞Êï∞ÊçÆ„ÄÇÈîôËØØ: ${error.message}`);
            }
            return false;
        }
    }

    // Êõ¥Êñ∞ÂçïÊù°ÊéíÁè≠Êï∞ÊçÆÂà∞ API
    async function updateScheduleItem(index) {
        const item = scheduleData[index];
        if (!item.id) {
            console.error('Êï∞ÊçÆÊ≤°Êúâ IDÔºåÊó†Ê≥ïÊõ¥Êñ∞');
            return false;
        }

        try {
            const response = await fetch(`${API_BASE_URL}/schedule/${item.id}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(item)
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const updated = await response.json();
            scheduleData[index] = updated;
            console.log(`‚úÖ Â∑≤ÂêåÊ≠•Âà∞ÊúçÂä°Âô®: Á¨¨${item.week}Âë®`);
            return true;
        } catch (error) {
            console.error('‚ùå Êõ¥Êñ∞Â§±Ë¥•:', error);
            showError('‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
            return false;
        }
    }

    // Ëá™Âä®Âà∑Êñ∞Êï∞ÊçÆÔºàÂÆûÊó∂Âçè‰ΩúÔºâ
    let refreshInterval;
    function startAutoRefresh(intervalMs = 10000) {
        // ÊØè10ÁßíÈùôÈªòÊ£ÄÊü•Êï∞ÊçÆÊõ¥Êñ∞
        refreshInterval = setInterval(async () => {
            const hasChanges = await loadDataFromAPI(true); // ÈùôÈªòÊ®°Âºè
            if (hasChanges) {
                // ‰∏çÈáçÊñ∞Ê∏≤ÊüìÊï¥‰∏™È°µÈù¢ÔºåÈÅøÂÖçÈó™ÁÉÅ
                // Âè™Êõ¥Êñ∞ÁªüËÆ°Êï∞ÊçÆÔºàËøô‰∏™Êõ¥Êñ∞ÂæàÂπ≥ÊªëÔºå‰∏ç‰ºöÂºïËµ∑Èó™ÁÉÅÔºâ
                renderStats();
                console.log('üîÑ Ê£ÄÊµãÂà∞Êï∞ÊçÆÂèòÂåñÔºåÂ∑≤Âú®ÂêéÂè∞Êõ¥Êñ∞Êï∞ÊçÆ');
                // Ê≥®ÊÑèÔºöË°®Ê†ºÂÜÖÂÆπ‰∏ç‰ºöËá™Âä®Âà∑Êñ∞ÔºåÈÅøÂÖçÊâìÊñ≠Áî®Êà∑Êìç‰Ωú
                // Áî®Êà∑ÁöÑÊâãÂä®Êìç‰ΩúÔºàÁºñËæë„ÄÅÂãæÈÄâÔºâ‰ºöÂü∫‰∫éÊúÄÊñ∞Êï∞ÊçÆËøõË°å
            }
        }, intervalMs);
    }

    function stopAutoRefresh() {
        if (refreshInterval) {
            clearInterval(refreshInterval);
        }
    }

    // Ëá™Âä®ÂãæÈÄâÂ∑≤ËøáÊúüÁöÑÊó•Êúü
    async function autoCheckPastDates() {
        const today = new Date();
        today.setHours(0, 0, 0, 0); // Âè™ÊØîËæÉÊó•ÊúüÈÉ®ÂàÜ

        const updates = []; // ËÆ∞ÂΩïÈúÄË¶ÅÊõ¥Êñ∞ÁöÑÈ°πÁõÆ

        scheduleData.forEach((item, index) => {
            if (item.isHoliday) return;

            const itemDate = new Date(item.date);
            itemDate.setHours(0, 0, 0, 0);

            // Â¶ÇÊûúÊó•ÊúüÂ∑≤ËøáÔºåÊ£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅËá™Âä®ÂãæÈÄâ
            if (itemDate < today) {
                let needsUpdate = false;

                // Âè™ÂãæÈÄâÊú™ÂÆåÊàêÁöÑ‰ªªÂä°
                if (item.T1 && !item.T1_done) {
                    item.T1_done = true;
                    needsUpdate = true;
                }
                if (item.T2_1 && !item.T2_1_done) {
                    item.T2_1_done = true;
                    needsUpdate = true;
                }
                if (item.T2_2 && !item.T2_2_done) {
                    item.T2_2_done = true;
                    needsUpdate = true;
                }
                if (item.T3 && !item.T3_done) {
                    item.T3_done = true;
                    needsUpdate = true;
                }

                // Â¶ÇÊûúÊúâ‰ªªÂä°Ë¢´Ëá™Âä®ÂãæÈÄâÔºåËÆ∞ÂΩïËØ•È°πÁõÆ
                if (needsUpdate) {
                    updates.push(index);
                }
            }
        });

        // ÊâπÈáèÂêåÊ≠•Âà∞Êï∞ÊçÆÂ∫ì
        if (updates.length > 0) {
            console.log(`üîÑ Ê£ÄÊµãÂà∞ ${updates.length} ‰∏™ËøáÊúü‰ªªÂä°ÔºåÊ≠£Âú®Ëá™Âä®ÂãæÈÄâÂπ∂ÂêåÊ≠•Âà∞ÊúçÂä°Âô®...`);

            for (const index of updates) {
                await updateScheduleItem(index);
            }

            console.log(`‚úÖ Â∑≤Ëá™Âä®ÂãæÈÄâÂπ∂ÂêåÊ≠• ${updates.length} ‰∏™ËøáÊúü‰ªªÂä°`);
        }
    }

    // --- 5. ÁïôË®ÄÊùøÂäüËÉΩ ---

    // ÁïôË®ÄÊùøÊï∞ÊçÆ
    let messageBoardData = {
        feedbacks: [], // ÂèçÈ¶àÂàóË°®Ôºö[{id, date, category, description, completed}]
        notice: ''
    };

    // ÈóÆÈ¢òÁßçÁ±ªÈÄâÈ°π
    const categoryOptions = ['ÊúçÂä°‰ºòÂåñ', 'ÂäüËÉΩÂª∫ËÆÆ', 'BugÂèçÈ¶à', '‰ΩøÁî®ÈóÆÈ¢ò', 'ÂÖ∂‰ªñ'];

    // Êõ¥Êñ∞ÂèçÈ¶àÁªüËÆ°
    function updateFeedbackStats() {
        const feedbacks = messageBoardData.feedbacks || [];
        const total = feedbacks.length;
        const completed = feedbacks.filter(f => f.completed).length;
        const pending = total - completed;

        document.getElementById('feedbackTotal').textContent = total;
        document.getElementById('feedbackCompleted').textContent = completed;
        document.getElementById('feedbackPending').textContent = pending;
    }

    // Ê∏≤ÊüìÂèçÈ¶àË°®Ê†º
    function renderFeedbackTable() {
        const feedbackBody = document.getElementById('feedbackBody');

        // Êõ¥Êñ∞ÁªüËÆ°
        updateFeedbackStats();

        if (!messageBoardData.feedbacks || messageBoardData.feedbacks.length === 0) {
            feedbackBody.innerHTML = `
                <tr>
                    <td colspan="6" class="feedback-empty">ÊöÇÊó†ÂèçÈ¶àÔºåÁÇπÂáª‰∏ãÊñπÊåâÈíÆÊ∑ªÂä†</td>
                </tr>
            `;
            return;
        }

        // ÊéíÂ∫èÔºöÊú™ÂÆåÊàêÁöÑÈóÆÈ¢òÂú®ÂâçÔºåÂ∑≤ÂÆåÊàêÁöÑÂú®ÂêéÔºàÊåâÊ∑ªÂä†È°∫Â∫èÔºâ
        const sortedFeedbacks = [...messageBoardData.feedbacks].sort((a, b) => {
            // Â¶ÇÊûúÂÆåÊàêÁä∂ÊÄÅ‰∏çÂêåÔºåÊú™ÂÆåÊàêÁöÑÊéíÂú®ÂâçÈù¢
            if (a.completed !== b.completed) {
                return a.completed ? 1 : -1;
            }
            // Áõ∏ÂêåÁä∂ÊÄÅ‰∏ãÔºåÊåâidÂÄíÂ∫èÔºàÊúÄÊñ∞ÁöÑÂú®ÂâçÔºâ
            return b.id - a.id;
        });

        feedbackBody.innerHTML = sortedFeedbacks.map((item, index) => {
            // ÊâæÂà∞ËØ•È°πÁõÆÂú®ÂéüÂßãÊï∞ÁªÑ‰∏≠ÁöÑÁ¥¢Âºï
            const originalIndex = messageBoardData.feedbacks.findIndex(f => f.id === item.id);
            return `
            <tr data-index="${originalIndex}">
                <td class="seq-num">${index + 1}</td>
                <td>
                    <div class="editable-cell" data-field="date" data-index="${originalIndex}">
                        ${item.date || 'ÁÇπÂáªËÆæÁΩÆ'}
                    </div>
                </td>
                <td>
                    <div class="editable-cell" data-field="category" data-index="${originalIndex}">
                        <span class="category-tag ${item.category || ''}">${item.category || 'ÁÇπÂáªÈÄâÊã©'}</span>
                    </div>
                </td>
                <td>
                    <div class="editable-cell" data-field="description" data-index="${originalIndex}">
                        ${item.description || 'ÁÇπÂáªËæìÂÖ•ÊèèËø∞'}
                    </div>
                </td>
                <td>
                    <span class="status-badge ${item.completed ? 'completed' : 'pending'}"
                          data-index="${originalIndex}"
                          onclick="toggleFeedbackStatus(${originalIndex})">
                        ${item.completed ? '‚úì Â∑≤ÂÆåÊàê' : '‚óã ÂæÖÂ§ÑÁêÜ'}
                    </span>
                </td>
                <td>
                    <button class="delete-feedback-btn" onclick="deleteFeedback(${originalIndex})" title="Âà†Èô§">√ó</button>
                </td>
            </tr>
            `;
        }).join('');

        // ÁªëÂÆöÁºñËæë‰∫ã‰ª∂
        addFeedbackEditListeners();
    }

    // ÁªëÂÆöÂèçÈ¶àË°®Ê†ºÁºñËæë‰∫ã‰ª∂
    function addFeedbackEditListeners() {
        document.querySelectorAll('.feedback-table .editable-cell').forEach(cell => {
            cell.addEventListener('click', handleFeedbackCellClick);
        });
    }

    // Â§ÑÁêÜÂçïÂÖÉÊ†ºÁÇπÂáª
    function handleFeedbackCellClick(e) {
        const cell = e.currentTarget;
        if (cell.querySelector('input') || cell.querySelector('select')) return;

        const field = cell.getAttribute('data-field');
        const index = parseInt(cell.getAttribute('data-index'));
        const item = messageBoardData.feedbacks[index];

        if (field === 'category') {
            // ‰∏ãÊãâÈÄâÊã©
            const currentValue = item.category || '';
            cell.innerHTML = `
                <select>
                    <option value="">ÈÄâÊã©ÁßçÁ±ª</option>
                    ${categoryOptions.map(opt =>
                        `<option value="${opt}" ${opt === currentValue ? 'selected' : ''}>${opt}</option>`
                    ).join('')}
                </select>
            `;
            const select = cell.querySelector('select');
            select.focus();

            const save = async () => {
                const newValue = select.value;
                messageBoardData.feedbacks[index].category = newValue;
                cell.innerHTML = `<span class="category-tag ${newValue}">${newValue || 'ÁÇπÂáªÈÄâÊã©'}</span>`;
                await updateMessageBoard();
            };

            select.addEventListener('blur', save);
            select.addEventListener('change', () => select.blur());
        } else if (field === 'date') {
            // Êó•ÊúüËæìÂÖ•
            const currentValue = item.date || '';
            cell.innerHTML = `<input type="date" value="${currentValue}">`;
            const input = cell.querySelector('input');
            input.focus();

            const save = async () => {
                const newValue = input.value;
                messageBoardData.feedbacks[index].date = newValue;
                cell.innerHTML = newValue || 'ÁÇπÂáªËÆæÁΩÆ';
                await updateMessageBoard();
            };

            input.addEventListener('blur', save);
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') input.blur();
            });
        } else if (field === 'description') {
            // ÊèèËø∞ËæìÂÖ•
            const currentValue = item.description || '';
            cell.innerHTML = `<input type="text" value="${currentValue}" placeholder="ËæìÂÖ•ÊèèËø∞">`;
            const input = cell.querySelector('input');
            input.focus();
            input.select();

            const save = async () => {
                const newValue = input.value.trim();
                messageBoardData.feedbacks[index].description = newValue;
                cell.innerHTML = newValue || 'ÁÇπÂáªËæìÂÖ•ÊèèËø∞';
                await updateMessageBoard();
            };

            input.addEventListener('blur', save);
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') input.blur();
            });
        }
    }

    // ÂàáÊç¢ÂÆåÊàêÁä∂ÊÄÅ
    async function toggleFeedbackStatus(index) {
        messageBoardData.feedbacks[index].completed = !messageBoardData.feedbacks[index].completed;
        renderFeedbackTable();
        await updateMessageBoard();
    }

    // Ê∑ªÂä†ÂèçÈ¶à
    async function addFeedback() {
        const today = new Date().toISOString().split('T')[0];
        const newFeedback = {
            id: Date.now(),
            date: today,
            category: '',
            description: '',
            completed: false
        };

        if (!messageBoardData.feedbacks) {
            messageBoardData.feedbacks = [];
        }
        // ‰ΩøÁî®unshiftËÆ©ÊúÄÊñ∞Ê∑ªÂä†ÁöÑÈóÆÈ¢òÊòæÁ§∫Âú®È°∂ÈÉ®
        messageBoardData.feedbacks.unshift(newFeedback);
        renderFeedbackTable();
        await updateMessageBoard();
    }

    // Âà†Èô§ÂèçÈ¶à
    async function deleteFeedback(index) {
        if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ÂèçÈ¶àÂêóÔºü')) {
            messageBoardData.feedbacks.splice(index, 1);
            renderFeedbackTable();
            await updateMessageBoard();
        }
    }

    // Ê∏≤ÊüìÁïôË®ÄÊùøÂÜÖÂÆπ
    function renderMessageBoard() {
        // Ê∏≤ÊüìÂèçÈ¶àË°®Ê†º
        renderFeedbackTable();

        // Ê∏≤ÊüìÂÖ¨Âëä
        const noticeContent = document.getElementById('noticeContent');
        if (messageBoardData.notice) {
            noticeContent.textContent = messageBoardData.notice;
            noticeContent.classList.remove('empty');
        } else {
            noticeContent.textContent = 'ÁÇπÂáªÊ≠§Â§ÑÂèëÂ∏ÉÂÖ¨Âëä...';
            noticeContent.classList.add('empty');
        }
    }

    // ÁªëÂÆöÁïôË®ÄÊùøÁºñËæë‰∫ã‰ª∂
    function addMessageBoardListeners() {
        const noticeContent = document.getElementById('noticeContent');
        noticeContent.addEventListener('click', handleNoticeClick);

        // Ê∑ªÂä†ÂèçÈ¶àÊåâÈíÆ
        document.getElementById('addFeedbackBtn').addEventListener('click', addFeedback);
    }

    // Â§ÑÁêÜÂÖ¨ÂëäÁÇπÂáª‰∫ã‰ª∂
    function handleNoticeClick(e) {
        const element = e.currentTarget;

        if (element.querySelector('textarea')) return;

        const currentText = element.classList.contains('empty') ? '' : element.textContent.trim();

        element.innerHTML = `<textarea placeholder="Shift+EnterÊç¢Ë°åÔºåEnter‰øùÂ≠ò">${currentText}</textarea>`;
        element.classList.add('editing');

        const textarea = element.querySelector('textarea');
        textarea.focus();
        textarea.setSelectionRange(textarea.value.length, textarea.value.length);

        const save = async () => {
            const newText = textarea.value.trim();
            messageBoardData.notice = newText;

            if (newText) {
                element.textContent = newText;
                element.classList.remove('empty');
            } else {
                element.textContent = 'ÁÇπÂáªÊ≠§Â§ÑÂèëÂ∏ÉÂÖ¨Âëä...';
                element.classList.add('empty');
            }

            element.classList.remove('editing');
            await updateMessageBoard();
        };

        textarea.addEventListener('blur', save);

        textarea.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                if (event.shiftKey || event.altKey || event.metaKey) {
                    event.preventDefault();
                    const start = textarea.selectionStart;
                    const end = textarea.selectionEnd;
                    const value = textarea.value;
                    textarea.value = value.substring(0, start) + '\n' + value.substring(end);
                    textarea.selectionStart = textarea.selectionEnd = start + 1;
                } else {
                    event.preventDefault();
                    textarea.blur();
                }
            }
        });
    }

    // ‰ªéAPIÂä†ËΩΩÁïôË®ÄÊùøÊï∞ÊçÆ
    async function loadMessageBoard() {
        try {
            const response = await fetch(`${API_BASE_URL}/messageBoard`);

            if (!response.ok) {
                // Â¶ÇÊûúÊé•Âè£‰∏çÂ≠òÂú®ÔºåËøîÂõûÈªòËÆ§Êï∞ÊçÆ
                if (response.status === 404) {
                    console.log('ÁïôË®ÄÊùøÊé•Âè£‰∏çÂ≠òÂú®Ôºå‰ΩøÁî®ÈªòËÆ§Êï∞ÊçÆ');
                    return;
                }
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            // ÂÖºÂÆπÊóßÊï∞ÊçÆÊ†ºÂºèÔºöÂ¶ÇÊûúÊúâ message Â≠óÊÆµ‰ΩÜÊ≤°Êúâ feedbacksÔºåÂàôËΩ¨Êç¢
            if (data) {
                if (data.feedbacks) {
                    // Êñ∞Ê†ºÂºè
                    messageBoardData = data;
                } else {
                    // ÊóßÊ†ºÂºèÔºåËøõË°åËΩ¨Êç¢
                    messageBoardData = {
                        feedbacks: [],
                        notice: data.notice || ''
                    };
                    // Â¶ÇÊûúÊúâÊóßÁöÑ message ÂÜÖÂÆπÔºåÂèØ‰ª•Â∞ùËØïËß£ÊûêÊàñÂøΩÁï•
                    console.log('Ê£ÄÊµãÂà∞ÊóßÊï∞ÊçÆÊ†ºÂºèÔºåÂ∑≤ËΩ¨Êç¢‰∏∫Êñ∞Ê†ºÂºè');
                }
            }
            renderMessageBoard();
        } catch (error) {
            console.log('ÁïôË®ÄÊùøÊï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§Êï∞ÊçÆ:', error.message);
        }
    }

    // ==================== ÊñáÊ°£Â∫ìÂäüËÉΩ ====================
    let allFilesData = [];
    let filteredFilesData = [];
    let currentPage = 1;
    const filesPerPage = 10;
    let selectedFiles = new Set(); // Â≠òÂÇ®ÈÄâ‰∏≠ÁöÑÊñá‰ª∂Á¥¢Âºï

    // ËÆ°ÁÆóÂàÜÈ°µÊï∞ÊçÆ
    function getPaginatedFiles() {
        const startIndex = (currentPage - 1) * filesPerPage;
        const endIndex = startIndex + filesPerPage;
        return filteredFilesData.slice(startIndex, endIndex);
    }

    // Ëé∑ÂèñÊÄªÈ°µÊï∞
    function getTotalPages() {
        return Math.ceil(filteredFilesData.length / filesPerPage);
    }

    // Âä†ËΩΩÊñáÊ°£Â∫ìÊï∞ÊçÆ
    async function loadDocumentLibrary() {
        try {
            const response = await fetch(`${API_BASE_URL}/files/all`);

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            allFilesData = data.files || [];
            filteredFilesData = [...allFilesData];
            // Ê∏ÖÁ©∫ÈÄâ‰∏≠Áä∂ÊÄÅ
            selectedFiles.clear();
            currentPage = 1;
            renderDocumentLibrary();
        } catch (error) {
            console.error('ÊñáÊ°£Â∫ìÊï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
            renderEmptyLibrary();
        }
    }

    // Ê∏≤ÊüìÊñáÊ°£Â∫ì
    function renderDocumentLibrary() {
        const contentDiv = document.getElementById('documentLibraryContent');
        const totalCountSpan = document.getElementById('totalFilesCount');

        totalCountSpan.textContent = filteredFilesData.length;

        if (filteredFilesData.length === 0) {
            renderEmptyLibrary();
            return;
        }

        const fileList = document.createElement('div');
        fileList.className = 'document-list';

        // Ëé∑ÂèñÂàÜÈ°µÊï∞ÊçÆ
        const paginatedFiles = getPaginatedFiles();
        const startIndex = (currentPage - 1) * filesPerPage;

        paginatedFiles.forEach((file, index) => {
            // ‰ΩøÁî®ÂÖ®Â±ÄÁ¥¢Âºï‰Ωú‰∏∫ÈÄâ‰∏≠Ê†áËØÜ
            const globalIndex = startIndex + index;
            const fileItem = createFileItem(file, globalIndex);
            fileList.appendChild(fileItem);
        });

        contentDiv.innerHTML = '';
        contentDiv.appendChild(fileList);

        // Ê∏≤ÊüìÂàÜÈ°µÊéß‰ª∂
        renderPagination();

        // Êõ¥Êñ∞ÊâπÈáè‰∏ãËΩΩÊåâÈíÆÁä∂ÊÄÅ
        updateBatchDownloadButton();
    }

    // Ê∏≤ÊüìÂàÜÈ°µÊéß‰ª∂
    function renderPagination() {
        const totalPages = getTotalPages();
        if (totalPages <= 1) return;

        const paginationDiv = document.createElement('div');
        paginationDiv.className = 'pagination';

        // ‰∏ä‰∏ÄÈ°µÊåâÈíÆ
        const prevBtn = document.createElement('button');
        prevBtn.className = 'pagination-btn';
        prevBtn.textContent = '‰∏ä‰∏ÄÈ°µ';
        prevBtn.disabled = currentPage === 1;
        prevBtn.onclick = () => goToPage(currentPage - 1);
        paginationDiv.appendChild(prevBtn);

        // È°µÁ†ÅÊåâÈíÆ
        const maxVisiblePages = 5;
        let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

        if (endPage - startPage + 1 < maxVisiblePages) {
            startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }

        for (let i = startPage; i <= endPage; i++) {
            const pageBtn = document.createElement('button');
            pageBtn.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
            pageBtn.textContent = i;
            pageBtn.onclick = () => goToPage(i);
            paginationDiv.appendChild(pageBtn);
        }

        // ‰∏ã‰∏ÄÈ°µÊåâÈíÆ
        const nextBtn = document.createElement('button');
        nextBtn.className = 'pagination-btn';
        nextBtn.textContent = '‰∏ã‰∏ÄÈ°µ';
        nextBtn.disabled = currentPage === totalPages;
        nextBtn.onclick = () => goToPage(currentPage + 1);
        paginationDiv.appendChild(nextBtn);

        // Ê∑ªÂä†ÂàÜÈ°µ‰ø°ÊÅØ
        const pageInfo = document.createElement('span');
        pageInfo.className = 'pagination-info';
        pageInfo.textContent = `Á¨¨ ${currentPage} / ${totalPages} È°µÔºåÂÖ± ${filteredFilesData.length} ‰∏™Êñá‰ª∂`;
        paginationDiv.appendChild(pageInfo);

        const contentDiv = document.getElementById('documentLibraryContent');
        contentDiv.appendChild(paginationDiv);
    }

    // Ë∑≥ËΩ¨Âà∞ÊåáÂÆöÈ°µ
    function goToPage(page) {
        const totalPages = getTotalPages();
        if (page < 1 || page > totalPages) return;
        currentPage = page;
        renderDocumentLibrary();
    }

    // ÂàõÂª∫Êñá‰ª∂È°πÂÖÉÁ¥†
    function createFileItem(file, index) {
        const item = document.createElement('div');
        item.className = 'document-item';
        item.style.animationDelay = `${index * 0.05}s`;

        // Êñá‰ª∂ÂõæÊ†áÔºàÊ†πÊçÆÊñá‰ª∂Á±ªÂûãÔºâ
        const icon = getFileIcon(file.name || file.filename);

        // Ê†ºÂºèÂåñÊñá‰ª∂Â§ßÂ∞è
        const sizeFormatted = file.size ? formatFileSize(file.size) : 'Êú™Áü•Â§ßÂ∞è';

        // Ê†ºÂºèÂåñ‰∏ä‰º†Êó∂Èó¥
        const uploadDate = file.uploadDate ? new Date(file.uploadDate).toLocaleString('zh-CN') : 'Êú™Áü•Êó∂Èó¥';

        // Ê£ÄÊü•ÊòØÂê¶Ë¢´ÈÄâ‰∏≠
        const isSelected = selectedFiles.has(index);

        // ÂàõÂª∫È¢ÑËßàÊåâÈíÆÔºàÊõø‰ª£ÂéüÊù•ÁöÑ‰∏ãËΩΩÊåâÈíÆÔºâ
        const previewBtn = document.createElement('button');
        previewBtn.className = 'download-btn';
        previewBtn.innerHTML = 'È¢ÑËßà';
        previewBtn.title = 'ÊâìÂºÄÈ¢ÑËßà';
        previewBtn.onclick = () => openLibraryFilePreview(file);

        item.innerHTML = `
            <div class="document-checkbox">
                <input type="checkbox" class="file-checkbox" ${isSelected ? 'checked' : ''} data-index="${index}">
            </div>
            <div class="document-icon">${icon}</div>
            <div class="document-info">
                <div class="document-name">${file.name || file.filename}</div>
                <div class="document-meta">
                    <span class="document-meta-item">üìÖ ${file.scheduleDate || 'Êú™Áü•Êó•Êúü'}</span>
                    <span class="document-meta-item">üìä Á¨¨${file.scheduleWeek || '?'}Âë®</span>
                    <span class="document-size">üïí ${uploadDate}</span>
                    <span class="document-size">üì¶ ${sizeFormatted}</span>
                </div>
            </div>
            <div class="document-actions"></div>
        `;
        item.querySelector('.document-actions').appendChild(previewBtn);

        // Ê∑ªÂä†‰∏ãËΩΩÈìæÊé•ÔºàÈöêËóèÔºåÁî®‰∫éÈ¢ÑËßàÈ°µÈù¢ÁöÑ‰∏ãËΩΩÂäüËÉΩÔºâ
        const downloadLink = document.createElement('a');
        downloadLink.href = `${API_BASE_URL}${file.downloadUrl}`;
        downloadLink.download = file.name || file.filename;
        downloadLink.style.display = 'none';
        downloadLink.className = 'hidden-download-link';
        item.appendChild(downloadLink);

        return item;
    }

    // ÂàáÊç¢Êñá‰ª∂ÈÄâ‰∏≠Áä∂ÊÄÅ
    function toggleFileSelection(index, selected) {
        if (selected) {
            selectedFiles.add(index);
        } else {
            selectedFiles.delete(index);
        }
        updateBatchDownloadButton();
    }

    // ÂÖ®ÈÄâ/ÂèñÊ∂àÂÖ®ÈÄâ
    function toggleSelectAll() {
        const paginatedFiles = getPaginatedFiles();
        const startIndex = (currentPage - 1) * filesPerPage;

        // Ê£ÄÊü•ÂΩìÂâçÈ°µÊòØÂê¶ÂÖ®ÈÉ®ÈÄâ‰∏≠
        const allSelected = paginatedFiles.every((_, i) => selectedFiles.has(startIndex + i));

        if (allSelected) {
            // ÂèñÊ∂àÂÖ®ÈÄâ
            paginatedFiles.forEach((_, i) => {
                selectedFiles.delete(startIndex + i);
            });
        } else {
            // ÂÖ®ÈÄâ
            paginatedFiles.forEach((_, i) => {
                selectedFiles.add(startIndex + i);
            });
        }
        renderDocumentLibrary();
    }

    // Ëé∑ÂèñÈÄâ‰∏≠ÁöÑÊñá‰ª∂
    function getSelectedFiles() {
        const selected = [];
        selectedFiles.forEach(index => {
            if (index < filteredFilesData.length) {
                selected.push(filteredFilesData[index]);
            }
        });
        return selected;
    }

    // Êõ¥Êñ∞ÊâπÈáè‰∏ãËΩΩÊåâÈíÆÁä∂ÊÄÅ
    function updateBatchDownloadButton() {
        const batchBtn = document.getElementById('batchDownloadBtn');
        const count = selectedFiles.size;
        if (batchBtn) {
            batchBtn.textContent = `üì¶ ÊâπÈáè‰∏ãËΩΩ (${count})`;
            batchBtn.disabled = count === 0;
        }
    }

    // ÊâπÈáè‰∏ãËΩΩÈÄâ‰∏≠ÁöÑÊñá‰ª∂
    async function batchDownload() {
        const selected = getSelectedFiles();
        if (selected.length === 0) {
            showError('ËØ∑ÂÖàÈÄâÊã©Ë¶Å‰∏ãËΩΩÁöÑÊñá‰ª∂');
            return;
        }

        showLoading(true, 'Ê≠£Âú®ÂáÜÂ§á‰∏ãËΩΩ...');

        try {
            if (selected.length === 1) {
                // Âçï‰∏™Êñá‰ª∂Áõ¥Êé•‰∏ãËΩΩ
                const file = selected[0];
                const link = document.createElement('a');
                link.href = `${API_BASE_URL}${file.downloadUrl}`;
                link.download = file.name || file.filename;
                link.click();
                showSuccess('ÂºÄÂßã‰∏ãËΩΩ');
            } else {
                // Â§ö‰∏™Êñá‰ª∂ÔºåÈÄê‰∏™‰∏ãËΩΩÔºàÊ®°ÊãüÊâπÈáè‰∏ãËΩΩÔºâ
                let successCount = 0;
                let failCount = 0;

                for (let i = 0; i < selected.length; i++) {
                    const file = selected[i];
                    try {
                        // ÂàõÂª∫‰∏ãËΩΩÈìæÊé•
                        const link = document.createElement('a');
                        link.href = `${API_BASE_URL}${file.downloadUrl}`;
                        link.download = file.name || file.filename;

                        // Ëß¶Âèë‰∏ãËΩΩ
                        link.click();
                        successCount++;

                        // Ê∑ªÂä†Â∞èÂª∂ËøüÈÅøÂÖçÊµèËßàÂô®Êã¶Êà™
                        await new Promise(resolve => setTimeout(resolve, 100));
                    } catch (error) {
                        console.error(`‰∏ãËΩΩÂ§±Ë¥•: ${file.name}`, error);
                        failCount++;
                    }
                }

                if (successCount > 0) {
                    showSuccess(`Â∑≤Ëß¶Âèë ${successCount} ‰∏™Êñá‰ª∂ÁöÑ‰∏ãËΩΩ`);
                }
                if (failCount > 0) {
                    showError(`${failCount} ‰∏™Êñá‰ª∂‰∏ãËΩΩÂ§±Ë¥•`);
                }
            }
        } catch (error) {
            console.error('ÊâπÈáè‰∏ãËΩΩÂ§±Ë¥•:', error);
            showError('ÊâπÈáè‰∏ãËΩΩÂ§±Ë¥•: ' + error.message);
        } finally {
            showLoading(false);
        }
    }

    // ‰ªéÊñáÊ°£Â∫ìÊâìÂºÄÊñá‰ª∂È¢ÑËßà
    async function openLibraryFilePreview(file) {
        currentPreviewFile = { index: file.scheduleId - 1, fileIndex: file.fileIndex, file };

        const previewSection = document.getElementById('filePreviewSection');
        const previewContent = document.getElementById('filePreviewContentInline');
        const previewTitle = document.getElementById('previewFileNameInline');
        const previewInfo = document.getElementById('previewFileInfoInline');

        // ËÆæÁΩÆÊñá‰ª∂ÂêçÂíå‰ø°ÊÅØ
        const fileName = file.name || file.filename || `Êñá‰ª∂`;
        const fileSize = file.size ? formatFileSize(file.size) : '';
        const uploadDate = file.uploadDate ? new Date(file.uploadDate).toLocaleString('zh-CN') : '';

        previewTitle.textContent = fileName;
        previewInfo.textContent = `Â§ßÂ∞è: ${fileSize}${uploadDate ? ' | ‰∏ä‰º†Êó∂Èó¥: ' + uploadDate : ''}${file.scheduleDate ? ' | ÊâÄÂ±ûÊó•Êúü: ' + file.scheduleDate : ''}`;

        // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
        previewContent.innerHTML = '<div class="preview-loading">Ê≠£Âú®Âä†ËΩΩÈ¢ÑËßà...</div>';

        // ÊòæÁ§∫ÂÖ®Â±èÈ¢ÑËßàÂå∫Âüü
        previewSection.style.display = 'flex';
        previewSection.style.position = 'fixed';
        previewSection.style.top = '0';
        previewSection.style.left = '0';
        previewSection.style.width = '100vw';
        previewSection.style.height = '100vh';
        previewSection.style.maxHeight = '100vh';
        previewSection.style.zIndex = '10000';
        document.body.style.overflow = 'hidden';

        // Âä†ËΩΩÊñá‰ª∂È¢ÑËßà
        try {
            await loadLibraryFilePreview(file);
        } catch (error) {
            previewContent.innerHTML = `<div class="preview-error">È¢ÑËßàÂä†ËΩΩÂ§±Ë¥•: ${error.message}</div>`;
        }
    }

    // Âä†ËΩΩÊñáÊ°£Â∫ìÊñá‰ª∂È¢ÑËßàÂÜÖÂÆπ
    async function loadLibraryFilePreview(file) {
        const fileName = file.name || file.filename || '';
        const extension = fileName.split('.').pop().toLowerCase();

        const previewContent = document.getElementById('filePreviewContentInline');

        try {
            const response = await fetch(`${API_BASE_URL}/schedule/${file.scheduleId}/files/${file.fileIndex}`);

            if (!response.ok) {
                throw new Error(`Ëé∑ÂèñÊñá‰ª∂Â§±Ë¥•: ${response.status}`);
            }

            // Ê†πÊçÆÊñá‰ª∂Á±ªÂûãÊòæÁ§∫È¢ÑËßà
            if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'svg'].includes(extension)) {
                // ÂõæÁâáÊñá‰ª∂
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                previewContent.innerHTML = `
                    <div class="image-preview-inline">
                        <img src="${url}" alt="${fileName}" style="max-width: 100%; height: auto;">
                    </div>
                `;
            } else if (extension === 'pdf') {
                // PDFÊñá‰ª∂
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                previewContent.innerHTML = `
                    <div class="pdf-preview-inline">
                        <iframe src="${url}" frameborder="0"></iframe>
                    </div>
                `;
            } else if (['txt', 'md', 'json', 'js', 'html', 'css', 'csv'].includes(extension)) {
                // ÊñáÊú¨Êñá‰ª∂
                const text = await response.text();
                previewContent.innerHTML = `
                    <div class="text-preview-inline">
                        <pre>${escapeHtml(text)}</pre>
                    </div>
                `;
            } else {
                // ÂÖ∂‰ªñÊñá‰ª∂Á±ªÂûãÔºåÊòæÁ§∫Êñá‰ª∂‰ø°ÊÅØ
                previewContent.innerHTML = `
                    <div class="no-preview">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üìÑ</div>
                        <p>Ê≠§Êñá‰ª∂Á±ªÂûã‰∏çÊîØÊåÅÂú®Á∫øÈ¢ÑËßà</p>
                        <p style="font-size: 0.9rem; color: var(--text-tertiary); margin-top: 0.5rem;">
                            Êñá‰ª∂Á±ªÂûã: ${extension.toUpperCase()}
                        </p>
                        <button class="file-preview-download-btn" onclick="downloadCurrentLibraryFile()" style="margin-top: 1rem;">
                            üì• ‰∏ãËΩΩÊñá‰ª∂
                        </button>
                    </div>
                `;
            }
        } catch (error) {
            previewContent.innerHTML = `<div class="preview-error">È¢ÑËßàÂ§±Ë¥•: ${error.message}</div>`;
        }
    }

    // ‰∏ãËΩΩÂΩìÂâçÈ¢ÑËßàÁöÑÊñáÊ°£Â∫ìÊñá‰ª∂
    async function downloadCurrentLibraryFile() {
        if (currentPreviewFile && currentPreviewFile.file) {
            const file = currentPreviewFile.file;
            const downloadUrl = `${API_BASE_URL}/schedule/${file.scheduleId}/files/${file.fileIndex}`;

            // ÂàõÂª∫‰∏¥Êó∂‰∏ãËΩΩÈìæÊé•
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.download = file.name || file.filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    }

    // ‰øÆÊîπÂÖ®Â±Ä‰∏ãËΩΩÂáΩÊï∞ÔºåÊîØÊåÅÊñáÊ°£Â∫ìÊñá‰ª∂
    async function downloadCurrentFile() {
        if (currentPreviewFile) {
            // Ê£ÄÊü•ÊòØÂê¶ÊòØÊñáÊ°£Â∫ìÊñá‰ª∂ÔºàÊúâ scheduleId Âíå fileIndex Â±ûÊÄßÔºâ
            if (currentPreviewFile.file && currentPreviewFile.file.scheduleId !== undefined) {
                await downloadCurrentLibraryFile();
            } else {
                // ÂéüÊúâÁöÑÊéíÁè≠Ë°®Êñá‰ª∂‰∏ãËΩΩÈÄªËæë
                await handleFileDownload(currentPreviewFile.index, currentPreviewFile.fileIndex);
            }
        }
    }

    // Ê†πÊçÆÊñá‰ª∂Á±ªÂûãËøîÂõûÂõæÊ†á
    function getFileIcon(filename) {
        if (!filename) return 'üìÑ';

        const ext = filename.toLowerCase().split('.').pop();
        const iconMap = {
            'pdf': 'üìï',
            'doc': 'üìò',
            'docx': 'üìò',
            'ppt': 'üìô',
            'pptx': 'üìô',
            'xls': 'üìó',
            'xlsx': 'üìó',
            'txt': 'üìù',
            'md': 'üìÉ',
            'jpg': 'üñºÔ∏è',
            'jpeg': 'üñºÔ∏è',
            'png': 'üñºÔ∏è',
            'gif': 'üñºÔ∏è',
            'zip': 'üì¶',
            'rar': 'üì¶',
            'mp4': 'üé¨',
            'mp3': 'üéµ',
        };

        return iconMap[ext] || 'üìÑ';
    }

    // Ê∏≤ÊüìÁ©∫Áä∂ÊÄÅ
    function renderEmptyLibrary() {
        const contentDiv = document.getElementById('documentLibraryContent');
        contentDiv.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">üì≠</div>
                <div class="empty-state-text">ÊöÇÊó†Êñá‰ª∂</div>
                <div class="empty-state-subtext">ËøòÊ≤°ÊúâÂõ¢ÈòüÂàÜ‰∫´‰ªª‰ΩïÊñáÊ°£</div>
            </div>
        `;
        // Êõ¥Êñ∞ÊâπÈáè‰∏ãËΩΩÊåâÈíÆÁä∂ÊÄÅ
        updateBatchDownloadButton();
    }

    // Ê∑ªÂä†ÊñáÊ°£Â∫ì‰∫ã‰ª∂ÁõëÂê¨
    function addDocumentLibraryListeners() {
        const searchInput = document.getElementById('fileSearchInput');
        const sortSelect = document.getElementById('fileSortSelect');
        const refreshBtn = document.getElementById('refreshLibraryBtn');

        // ÊêúÁ¥¢ÂäüËÉΩ
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase().trim();
            filterAndSortFiles(searchTerm, sortSelect.value);
        });

        // ÊéíÂ∫èÂäüËÉΩ
        sortSelect.addEventListener('change', (e) => {
            const searchTerm = searchInput.value.toLowerCase().trim();
            filterAndSortFiles(searchTerm, e.target.value);
        });

        // Âà∑Êñ∞ÂäüËÉΩ
        refreshBtn.addEventListener('click', async () => {
            await refreshDocumentLibrary();
        });

        // ‰ΩøÁî®‰∫ã‰ª∂ÂßîÊâòÂ§ÑÁêÜÂ§çÈÄâÊ°Üchange‰∫ã‰ª∂
        const contentDiv = document.getElementById('documentLibraryContent');
        contentDiv.addEventListener('change', (e) => {
            if (e.target.classList.contains('file-checkbox')) {
                const index = parseInt(e.target.getAttribute('data-index'));
                const selected = e.target.checked;
                toggleFileSelection(index, selected);
            }
        });
    }

    // Âà∑Êñ∞ÊñáÊ°£Â∫ì
    async function refreshDocumentLibrary() {
        const refreshBtn = document.getElementById('refreshLibraryBtn');
        const originalText = refreshBtn.innerHTML;

        try {
            // Ê∑ªÂä†Âà∑Êñ∞Áä∂ÊÄÅ
            refreshBtn.classList.add('refreshing');
            refreshBtn.innerHTML = 'üîÑ Âà∑Êñ∞‰∏≠...';

            // ÈáçÊñ∞Âä†ËΩΩÊï∞ÊçÆ
            await loadDocumentLibrary();

            // Âà∑Êñ∞ÊàêÂäüÊèêÁ§∫
            console.log('‚úÖ ÊñáÊ°£Â∫ìÂ∑≤Âà∑Êñ∞');

            // 1ÁßíÂêéÊÅ¢Â§çÊåâÈíÆ
            setTimeout(() => {
                refreshBtn.classList.remove('refreshing');
                refreshBtn.innerHTML = originalText;
            }, 1000);
        } catch (error) {
            console.error('‚ùå ÊñáÊ°£Â∫ìÂà∑Êñ∞Â§±Ë¥•:', error);
            refreshBtn.classList.remove('refreshing');
            refreshBtn.innerHTML = '‚ùå Âà∑Êñ∞Â§±Ë¥•';

            // 2ÁßíÂêéÊÅ¢Â§çÊåâÈíÆ
            setTimeout(() => {
                refreshBtn.innerHTML = originalText;
            }, 2000);
        }
    }

    // ËøáÊª§ÂíåÊéíÂ∫èÊñá‰ª∂
    function filterAndSortFiles(searchTerm, sortOption) {
        // ËøáÊª§
        filteredFilesData = allFilesData.filter(file => {
            const fileName = (file.name || file.filename || '').toLowerCase();
            return fileName.includes(searchTerm);
        });

        // ÊéíÂ∫è
        filteredFilesData.sort((a, b) => {
            switch (sortOption) {
                case 'date-desc':
                    return new Date(b.uploadDate) - new Date(a.uploadDate);
                case 'date-asc':
                    return new Date(a.uploadDate) - new Date(b.uploadDate);
                case 'name-asc':
                    return (a.name || a.filename || '').localeCompare(b.name || b.filename || '', 'zh-CN');
                case 'name-desc':
                    return (b.name || b.filename || '').localeCompare(a.name || a.filename || '', 'zh-CN');
                default:
                    return 0;
            }
        });

        // ÈáçÁΩÆÂà∞Á¨¨‰∏ÄÈ°µ
        currentPage = 1;
        renderDocumentLibrary();
    }

    // Êõ¥Êñ∞ÁïôË®ÄÊùøÊï∞ÊçÆÂà∞API
    async function updateMessageBoard() {
        try {
            const response = await fetch(`${API_BASE_URL}/messageBoard`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(messageBoardData)
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            console.log('‚úÖ ÁïôË®ÄÊùøÂ∑≤ÂêåÊ≠•Âà∞ÊúçÂä°Âô®');
            return true;
        } catch (error) {
            console.error('‚ùå ÁïôË®ÄÊùøÊõ¥Êñ∞Â§±Ë¥•:', error);
            showError('ÁïôË®ÄÊùø‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
            return false;
        }
    }

    // È°µÈù¢Âä†ËΩΩÊó∂ÊâßË°å
    document.addEventListener('DOMContentLoaded', async () => {
        // È¶ñÂÖàÂ∞ùËØï‰ªéAPIÂä†ËΩΩÊï∞ÊçÆ
        const success = await loadDataFromAPI();

        // Âä†ËΩΩÁïôË®ÄÊùøÊï∞ÊçÆ
        await loadMessageBoard();
        addMessageBoardListeners();

        // Âä†ËΩΩÊñáÊ°£Â∫ì
        await loadDocumentLibrary();
        addDocumentLibraryListeners();

        // ÁªëÂÆöÊñá‰ª∂‰∫ã‰ª∂ÁõëÂê¨Âô®Ôºà‰ΩøÁî®‰∫ã‰ª∂ÂßîÊâòÔºåÂè™ÁªëÂÆö‰∏ÄÊ¨°Ôºâ
        addFileListeners();

        if (success) {
            // APIÂä†ËΩΩÊàêÂäüÔºåËá™Âä®ÂãæÈÄâËøáÊúüÊó•Êúü
            await autoCheckPastDates();
            renderSchedule();

            // ÂêØÂä®Ëá™Âä®Âà∑Êñ∞ÔºàÊØè10ÁßíÔºâ
            startAutoRefresh(10000);

            // È°µÈù¢ÂÖ≥Èó≠Êó∂ÂÅúÊ≠¢Ëá™Âä®Âà∑Êñ∞
            window.addEventListener('beforeunload', stopAutoRefresh);
        } else {
            // APIÂä†ËΩΩÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§Êï∞ÊçÆ
            await autoCheckPastDates();
            renderSchedule();
        }
    });

    // === Êñá‰ª∂È¢ÑËßàÊ®°ÊÄÅÊ°Ü ===
    let currentPreviewFile = null;

    // ÊâìÂºÄÊñá‰ª∂È¢ÑËßà
    async function openFilePreview(index, fileIndex) {
        const item = scheduleData[index];
        const file = item.files[fileIndex];
        currentPreviewFile = { index, fileIndex, file };

        const previewSection = document.getElementById('filePreviewSection');
        const previewContent = document.getElementById('filePreviewContentInline');
        const previewTitle = document.getElementById('previewFileNameInline');
        const previewInfo = document.getElementById('previewFileInfoInline');

        // ËÆæÁΩÆÊñá‰ª∂ÂêçÂíå‰ø°ÊÅØ
        const fileName = file.name || file.filename || `Êñá‰ª∂${fileIndex + 1}`;
        const fileSize = file.size ? formatFileSize(file.size) : '';
        const uploadDate = file.uploadDate ? new Date(file.uploadDate).toLocaleString() : '';

        previewTitle.textContent = fileName;
        previewInfo.textContent = `Â§ßÂ∞è: ${fileSize}${uploadDate ? ' | ‰∏ä‰º†Êó∂Èó¥: ' + uploadDate : ''}`;

        // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
        previewContent.innerHTML = '<div class="preview-loading">Ê≠£Âú®Âä†ËΩΩÈ¢ÑËßà...</div>';

        // ÊòæÁ§∫ÂÖ®Â±èÈ¢ÑËßàÂå∫Âüü
        previewSection.style.display = 'flex';
        previewSection.style.position = 'fixed';
        previewSection.style.top = '0';
        previewSection.style.left = '0';
        previewSection.style.width = '100vw';
        previewSection.style.height = '100vh';
        previewSection.style.maxHeight = '100vh';
        previewSection.style.zIndex = '10000';
        document.body.style.overflow = 'hidden';

        // Âä†ËΩΩÊñá‰ª∂È¢ÑËßà
        try {
            await loadFilePreview(index, fileIndex);
        } catch (error) {
            previewContent.innerHTML = `<div class="preview-error">È¢ÑËßàÂä†ËΩΩÂ§±Ë¥•: ${error.message}</div>`;
        }
    }

    // Âä†ËΩΩÊñá‰ª∂È¢ÑËßàÂÜÖÂÆπ
    async function loadFilePreview(index, fileIndex) {
        const item = scheduleData[index];
        const file = item.files[fileIndex];
        const fileName = file.name || file.filename || '';
        const extension = fileName.split('.').pop().toLowerCase();

        const previewContent = document.getElementById('filePreviewContentInline');

        try {
            const response = await fetch(`${API_BASE_URL}/schedule/${item.id || index}/files/${fileIndex}`);

            if (!response.ok) {
                throw new Error(`Ëé∑ÂèñÊñá‰ª∂Â§±Ë¥•: ${response.status}`);
            }

            // Ê†πÊçÆÊñá‰ª∂Á±ªÂûãÊòæÁ§∫È¢ÑËßà
            if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'svg'].includes(extension)) {
                // ÂõæÁâáÊñá‰ª∂
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                previewContent.innerHTML = `
                    <div class="image-preview-inline">
                        <img src="${url}" alt="${fileName}" style="max-width: 100%; height: auto;">
                    </div>
                `;
            } else if (extension === 'pdf') {
                // PDFÊñá‰ª∂
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                previewContent.innerHTML = `
                    <div class="pdf-preview-inline">
                        <iframe src="${url}" frameborder="0"></iframe>
                    </div>
                `;
            } else if (['txt', 'md', 'json', 'js', 'html', 'css', 'csv'].includes(extension)) {
                // ÊñáÊú¨Êñá‰ª∂
                const text = await response.text();
                previewContent.innerHTML = `
                    <div class="text-preview-inline">
                        <pre>${escapeHtml(text)}</pre>
                    </div>
                `;
            } else {
                // ÂÖ∂‰ªñÊñá‰ª∂Á±ªÂûãÔºåÊòæÁ§∫Êñá‰ª∂‰ø°ÊÅØ
                previewContent.innerHTML = `
                    <div class="no-preview">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üìÑ</div>
                        <p>Ê≠§Êñá‰ª∂Á±ªÂûã‰∏çÊîØÊåÅÂú®Á∫øÈ¢ÑËßà</p>
                        <p style="font-size: 0.9rem; color: var(--text-tertiary); margin-top: 0.5rem;">
                            Êñá‰ª∂Á±ªÂûã: ${extension.toUpperCase()}
                        </p>
                        <button class="file-preview-download-btn" onclick="downloadCurrentFile()" style="margin-top: 1rem;">
                            üì• ‰∏ãËΩΩÊñá‰ª∂
                        </button>
                    </div>
                `;
            }
        } catch (error) {
            previewContent.innerHTML = `<div class="preview-error">È¢ÑËßàÂ§±Ë¥•: ${error.message}</div>`;
        }
    }

    // ÂÖ≥Èó≠Êñá‰ª∂È¢ÑËßà
    function closeFilePreview() {
        const previewSection = document.getElementById('filePreviewSection');
        previewSection.style.display = 'none';
        document.body.style.overflow = 'auto';
        currentPreviewFile = null;
    }

    // ÂÖ≥Èó≠ÂÜÖËÅîÊñá‰ª∂È¢ÑËßàÔºàÂà´ÂêçÔºâ
    function closeInlineFilePreview() {
        closeFilePreview();
    }

    // ‰∏ãËΩΩÂΩìÂâçÈ¢ÑËßàÁöÑÊñá‰ª∂
    async function downloadCurrentFile() {
        if (currentPreviewFile) {
            await handleFileDownload(currentPreviewFile.index, currentPreviewFile.fileIndex);
        }
    }

    // HTMLËΩ¨‰πâÂáΩÊï∞
    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
</script>

    <!-- Êñá‰ª∂È¢ÑËßàÂå∫Âüü -->
    <div id="filePreviewSection" class="file-preview-section" style="display: none;">
        <div class="file-preview-header-inline">
            <div class="file-preview-title-inline">
                <h3 id="previewFileNameInline">Êñá‰ª∂Âêç</h3>
                <span id="previewFileInfoInline" class="file-preview-info-inline"></span>
            </div>
            <div class="file-preview-actions">
                <button class="file-preview-download-btn-inline" onclick="downloadCurrentFile()">
                    üì• ‰∏ãËΩΩ
                </button>
                <button class="file-preview-close-inline" onclick="closeInlineFilePreview()">√ó</button>
            </div>
        </div>
        <div class="file-preview-content-inline" id="filePreviewContentInline">
            <!-- È¢ÑËßàÂÜÖÂÆπÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÂä†ËΩΩ -->
        </div>
    </div>

</body>
</html>